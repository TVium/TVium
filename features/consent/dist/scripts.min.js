var Consent=function(e,n){var o=this,r=null;this.consentsDirectValidationOverlayComponent=new ConsentsDirectValidationOverlayComponent(e,n),this.consentsConfirmationOverlayComponent=new ConsentsConfirmationOverlayComponent(e,n),this.consentsParametersOverlayComponent=new ConsentsParametersOverlayComponent(e,n),this.consentsPrivacyPolicyComponent=new ConsentsPrivacyPolicyComponent(e,n),this.consentsPartnerComponent=new ConsentsPartnerComponent(e,n),this.consentsErrorComponent=new ConsentsErrorComponent(e,n);var t={};this.configure=function(e){t=e},this.getConfiguration=function(){return t},this.init=function(){var e=storageManager.getCookie(Constants.MODEL_COOKIE_NAME);null!=e&&(r=JSON.parse(e))},this.editAllConsentAndSend=function(e,n){for(var t=0;t<r.consents.length;t++)r.consents[t].consentStatus=e;o.sendConsents(function(e){n.removeKeyboardEvents(),o.consentsConfirmationOverlayComponent.showConsentConfirmationOverlay(null!=e&&null!=e?e:null)},function(){logManager.error("postConsent Error"),n.removeKeyboardEvents(),o.consentsErrorComponent.showConsentError()})},this.consentsDirectValidationOverlayComponent.setEnterKeyEventHandler(function(){try{switch(o.consentsDirectValidationOverlayComponent.getCurrentPosition()){case 0:o.editAllConsentAndSend(!0,o.consentsDirectValidationOverlayComponent);break;case 1:o.editAllConsentAndSend(!1,o.consentsDirectValidationOverlayComponent);break;case 2:o.consentsDirectValidationOverlayComponent.removeKeyboardEvents(),o.consentsParametersOverlayComponent.init(r),o.consentsParametersOverlayComponent.showConsentParametersOverlay(yellowButtonEnabled);break;case 3:o.consentsDirectValidationOverlayComponent.manageShowPrivacyPolicy();break;case 4:o.consentsDirectValidationOverlayComponent.manageShowPartner()}}catch(e){logManager.error(e.message)}}),this.consentsDirectValidationOverlayComponent.manageShowPrivacyPolicy=function(){o.consentsDirectValidationOverlayComponent.removeKeyboardEvents(),o.consentsPrivacyPolicyComponent.showConsentPrivacyPolicy("validation")},this.consentsDirectValidationOverlayComponent.manageShowPartner=function(){o.consentsDirectValidationOverlayComponent.removeKeyboardEvents(),o.consentsPartnerComponent.showConsentPartner("validation")},this.consentsPrivacyPolicyComponent.setEnterKeyEventHandler(function(){var e,n;$(".tvium-container .focused")[0]&&(e=$(".tvium-container .focused")[0].id,n=$("#backButton").attr("pagefrom"),"backButton"===e&&(o.consentsPrivacyPolicyComponent.removeKeyboardEvents(),"validation"==n?o.consentsDirectValidationOverlayComponent.showConsentDirectValidationOverlay():"parameters"==n?o.consentsParametersOverlayComponent.showConsentParametersOverlay(yellowButtonEnabled):"partenaires"==n&&o.consentsPartnerComponent.showConsentPartner("")))}),this.consentsPrivacyPolicyComponent.setBackKeyEventHandler(function(){var e=$("#backButton").attr("pagefrom");o.consentsPrivacyPolicyComponent.removeKeyboardEvents(),"validation"==e?o.consentsDirectValidationOverlayComponent.showConsentDirectValidationOverlay():"parameters"==e?o.consentsParametersOverlayComponent.showConsentParametersOverlay(yellowButtonEnabled):"partenaires"==e&&o.consentsPartnerComponent.showConsentPartner("")}),this.consentsPartnerComponent.setEnterKeyEventHandler(function(){if($(".tvium-container .focused")[0]){var e=$(".tvium-container .focused")[0].id,n=$("#backButton").attr("pagefrom");switch(e){case"backButton":o.consentsPartnerComponent.removeKeyboardEvents(),"validation"==n?o.consentsDirectValidationOverlayComponent.showConsentDirectValidationOverlay():"parameters"==n&&o.consentsParametersOverlayComponent.showConsentParametersOverlay(yellowButtonEnabled);break;case"politique":o.consentsPartnerComponent.removeKeyboardEvents(),o.consentsPrivacyPolicyComponent.showConsentPrivacyPolicy("partenaires")}}}),this.consentsPartnerComponent.setBackKeyEventHandler(function(){var e=$("#backButton").attr("pagefrom");o.consentsPartnerComponent.removeKeyboardEvents(),"validation"==e?o.consentsDirectValidationOverlayComponent.showConsentDirectValidationOverlay():"parameters"==e&&o.consentsParametersOverlayComponent.showConsentParametersOverlay(yellowButtonEnabled)}),this.consentsParametersOverlayComponent.manageShowPrivacyPolicy=function(e){o.consentsParametersOverlayComponent.removeKeyboardEvents(),o.consentsPrivacyPolicyComponent.showConsentPrivacyPolicy("parameters")},this.consentsParametersOverlayComponent.manageShowPartner=function(e){o.consentsParametersOverlayComponent.removeKeyboardEvents(),o.consentsPartnerComponent.showConsentPartner("parameters")},this.consentsParametersOverlayComponent.manageShowErrorMessage=function(){o.consentsParametersOverlayComponent.removeKeyboardEvents();var e=null;null!=r.toRequest&&null!=r.toRequest&&(e=r.toRequest),o.consentsErrorComponent.showConsentError(e)},this.consentsParametersOverlayComponent.setEnterKeyEventHandler(function(e){var n,t,a;try{"Oui"!=$(".focused").attr("name")&&"Non"!=$(".focused").attr("name")||$(".focused").hasClass("all")?"Oui"!=$(".focused").attr("name")&&"Non"!=$(".focused").attr("name")||!$(".focused").hasClass("all")?"Valider"==$(".focused").attr("name")?o.sendConsents(function(e){o.consentsParametersOverlayComponent.removeKeyboardEvents(),o.consentsConfirmationOverlayComponent.showConsentConfirmationOverlay(null!=e&&null!=e?e:null)},function(){logManager.error("postConsent Error"),r=JSON.parse(JSON.stringify(o.consentsParametersOverlayComponent.getAuxContentModel())),o.consentsParametersOverlayComponent.updateModel(r),o.consentsParametersOverlayComponent.removeKeyboardEvents(),o.consentsErrorComponent.showConsentError()}):$("#backButton").hasClass("focused")?((a=null)!=r.toRequest&&null!=r.toRequest&&(a=r.toRequest),1==yellowButtonEnabled?(r=JSON.parse(JSON.stringify(o.consentsParametersOverlayComponent.getAuxContentModel())),o.consentsParametersOverlayComponent.updateModel(r),o.consentsParametersOverlayComponent.removeKeyboardEvents()):(r=JSON.parse(JSON.stringify(o.consentsParametersOverlayComponent.getAuxContentModel())),o.consentsParametersOverlayComponent.updateModel(r),o.consentsParametersOverlayComponent.removeKeyboardEvents(),o.consentsDirectValidationOverlayComponent.showConsentDirectValidationOverlay(a))):$("#politique").hasClass("focused")?(r=JSON.parse(JSON.stringify(o.consentsParametersOverlayComponent.getAuxContentModel())),o.consentsParametersOverlayComponent.updateModel(r),o.consentsParametersOverlayComponent.manageShowPrivacyPolicy("parameters")):$("#partenaires").hasClass("focused")&&(r=JSON.parse(JSON.stringify(o.consentsParametersOverlayComponent.getAuxContentModel())),o.consentsParametersOverlayComponent.updateModel(r),o.consentsParametersOverlayComponent.manageShowPartner("parameters")):"Oui"==$(".focused").attr("name")?o.editAllConsentAndSend(!0,o.consentsParametersOverlayComponent):o.editAllConsentAndSend(!1,o.consentsParametersOverlayComponent):($(".focused").parent().nextAll(".consent-section__page__contain__buttons-container").first().children().removeClass("disabled"),0<$(".focused").parent().children(".active").length&&$(".focused").parent().children().removeClass("active"),$(".focused").addClass("active"),t=(n=$(".focused")[0].id).replace("t","").replace("f",""),parameterValue="t"==n.charAt(0),o.consentsParametersOverlayComponent.manageDownKeyEvent(),r.consents[parseInt(t)].consentStatus=parameterValue,o.consentsParametersOverlayComponent.updateModel(r))}catch(e){logManager.error(e.message)}}),this.consentsParametersOverlayComponent.setBackKeyEventHandler(function(){try{var e=null;null!=r.toRequest&&null!=r.toRequest&&(e=r.toRequest),1==yellowButtonEnabled?(r=JSON.parse(JSON.stringify(o.consentsParametersOverlayComponent.getAuxContentModel())),o.consentsParametersOverlayComponent.updateModel(r),o.consentsParametersOverlayComponent.removeKeyboardEvents()):(r=JSON.parse(JSON.stringify(o.consentsParametersOverlayComponent.getAuxContentModel())),o.consentsParametersOverlayComponent.updateModel(r),o.consentsParametersOverlayComponent.removeKeyboardEvents(),o.consentsDirectValidationOverlayComponent.showConsentDirectValidationOverlay(e))}catch(e){logManager.error(e.message)}}),this.loadConsentData=function(o,s){(new ConsentRequests).getConsentGET(function(e){r=e,storageManager.setCookie(Constants.MODEL_COOKIE_NAME,JSON.stringify(r));for(var n=!0,t=0;t<e.consents.length;t++)"TRACKING"==e.consents[t].purposeName&&(trackingConsent=e.consents[t].consentStatus),null==e.consents[t].consentStatus&&(n=!1);var a=0!=e.toRequest;a?o(e.toRequest):1==n&&(yellowButtonEnabled=!0),s(a)},function(){logManager.error("getConsent Error")})},this.sendConsents=function(n,e){try{for(var t=o.parseModelForPost(r),a=0;a<r.consents.length;a++)"TRACKING"==r.consents[a].purposeName&&(trackingConsent=r.consents[a].consentStatus);(new ConsentRequests).getConsentPOST(function(e){storageManager.setCookie(Constants.MODEL_COOKIE_NAME,JSON.stringify(o.getModel())),n(e.toAcknowledge)},function(){e()},t)}catch(e){logManager.error(e.message)}},this.parseModelForPost=function(e){try{for(var n={tvId:o.getModel().tvId,consents:[]},t=0;t<e.consents.length;t++){var a={purposeName:e.consents[t].purposeName,consentStatus:e.consents[t].consentStatus,purposeId:e.consents[t].purposeId};n.consents.push(a)}return n}catch(e){logManager.error(e.message)}},this.getModel=function(){return r},this.getModelConsents=function(){for(var e=[],n=0;n<r.consents.length;n++){var t={purposeName:r.consents[n].purposeName,consentStatus:r.consents[n].consentStatus,purposeId:r.consents[n].purposeId};e[r.consents[n].purposeName]=t}return e}},ConsentsConfirmationOverlayComponent=function(n,e){var t=consent.getConfiguration().CONSENT_CONFIRMATION_DISPLAY_TIME;function a(){$(".consent-section__banner").hide(0,function(){e(),$(".consent-section").empty()})}this.showConsentConfirmationOverlay=function(e){null!=e&&(t=e),n&&n(),$(".consent-section").load("features/consent/templates/consent__consents-confirmation-overlay.html",function(){$(".consent-section__banner__message").html(labelsManager.getLabel("CONSENT_CONFIRMATION_OVERLAY_TEXT")),$(".consent-section__banner").show(0,function(){yellowButtonEnabled=!0,keyDownTimeout=window.setTimeout(a,t)})})}},ConsentsDirectValidationOverlayComponent=function(n,e){var t=this,a=null,o=consent.getConfiguration().CONSENT_BANNER_DISPLAY_TIME,s=0,r=0;function c(){$(".consent-section__banner").hide(0,function(){t.removeKeyboardEvents(),e(),$(".consent-section").empty()})}function i(e){switch(window.clearTimeout(a),logManager.log("Keyset check - e.keyCode: "+e.keyCode+" e.code: "+e.code),e.keyCode){case KeyEvent.VK_UP:case e.VK_UP:case VK_UP:t.manageUpKeyEvent();break;case KeyEvent.VK_DOWN:case e.VK_DOWN:case VK_DOWN:t.manageDownKeyEvent();break;case KeyEvent.VK_RIGHT:case e.VK_RIGHT:case VK_RIGHT:t.manageRightKeyEvent();break;case KeyEvent.VK_LEFT:case e.VK_LEFT:case VK_LEFT:t.manageLeftKeyEvent();break;case KeyEvent.VK_ENTER:case e.VK_ENTER:case VK_ENTER:t.manageEnterKeyEvent()}e.preventDefault()}this.showConsentDirectValidationOverlay=function(e){null!=e&&(o=e),n&&n(),$(".consent-section").load("features/consent/templates/consent__consents-direct-validation-overlay.html",function(){t.registerKeyboardEvents(),t.setLabels(),$(".consent-section__banner").show(0,function(){consent.getConfiguration().CONSENT_DIRECT_DEFAULT_FOCUS&&(r=Number(consent.getConfiguration().CONSENT_DIRECT_DEFAULT_FOCUS)),s=r,$('.tvium-container [tabindex="'+s+'"]').focus(),a=window.setTimeout(c,o)})})},this.removeKeyboardEvents=function(){keyset.setValue(0),document.removeEventListener("keydown",i),e(),$(".consent-section").empty()},this.registerKeyboardEvents=function(){keyset.setValue(keyset.NAVIGATION),logManager.log("Keyset bound: keyset.NAVIGATION - "+JSON.stringify(app.privateData.keyset)),document.addEventListener("keydown",i)},this.manageDownKeyEvent=function(){try{s<3&&(s++,a=window.setTimeout(c,o),s<=3&&$('.tvium-container [tabindex="'+s+'"]').focus())}catch(e){logManager.error("manageDownKeyEvent()"+e.message)}},this.manageUpKeyEvent=function(){try{-1==s?s++:$(":focus").hasClass("link--reset")?s=Number($(".skipfocus").attr("tabindex"))+1:0<s&&s<=3&&(s--,a=window.setTimeout(c,o)),$('.tvium-container [tabindex="'+s+'"]').focus()}catch(e){logManager.error("manageUpKeyEvent()"+e.message)}},this.manageRightKeyEvent=function(){try{3!=s&&-1!=s||s++,$('.tvium-container [tabindex="'+s+'"]').focus()}catch(e){logManager.error("manageRightKeyEvent()"+e.message)}},this.manageLeftKeyEvent=function(){try{-1==s?s++:4==s&&s--,$('.tvium-container [tabindex="'+s+'"]').focus()}catch(e){logManager.error("manageLeftKeyEvent()"+e.message)}},this.manageEnterKeyEvent=null,this.setEnterKeyEventHandler=function(e){t.manageEnterKeyEvent=e},this.setLabels=function(){$(".consent-section__banner__left__logo").html(labelsManager.getLabel("CONSENT_DIRECT_VALIDATION_OVERLAY_LEFT_LOGO")),$(".consent-section__banner__left__title").html(labelsManager.getLabel("CONSENT_DIRECT_VALIDATION_OVERLAY_LEFT_TITLE")),$(".consent-section__banner__left__message").html(labelsManager.getLabel("CONSENT_DIRECT_VALIDATION_OVERLAY_LEFT_TEXT")),$("#politique").html(labelsManager.getLabel("CONSENT_DIRECT_VALIDATION_OVERLAY_LEFT_TEXT_DOWN_POLITIQUE")),$("#partenaires").html(labelsManager.getLabel("CONSENT_DIRECT_VALIDATION_OVERLAY_LEFT_TEXT_DOWN_PARTENAIRES")),$(".consent-section__banner__right__title").html(labelsManager.getLabel("CONSENT_DIRECT_VALIDATION_OVERLAY_RIGHT_TITLE")),$("#buttonOk").val(labelsManager.getLabel("CONSENT_DIRECT_VALIDATION_OVERLAY_OK_BUTTON")),$("#buttonParameter").val(labelsManager.getLabel("CONSENT_DIRECT_VALIDATION_OVERLAY_PARAMETERS_BUTTON")),$("#buttonRefuser").val(labelsManager.getLabel("CONSENT_DIRECT_VALIDATION_OVERLAY_REFUSER_BUTTON"))},this.getCurrentPosition=function(){return s}},ConsentsErrorComponent=function(n,e){var t=this,a=null,o=consent.getConfiguration().CONSENT_BANNER_DISPLAY_TIME;function s(){$(".consent-section__banner").hide(0,function(){window.clearTimeout(a),t.removeKeyboardEvents(),activeContext=null,e(),$(".consent-section").empty()})}function r(e){switch(logManager.log("Keyset check - e.keyCode: "+e.keyCode+" e.code: "+e.code),e.keyCode){case KeyEvent.VK_UP:case e.VK_UP:case VK_UP:break;case KeyEvent.VK_DOWN:case e.VK_DOWN:case VK_DOWN:break;case KeyEvent.VK_RIGHT:case e.VK_RIGHT:case VK_RIGHT:break;case KeyEvent.VK_LEFT:case e.VK_LEFT:case VK_LEFT:break;case KeyEvent.VK_ENTER:case e.VK_ENTER:case VK_ENTER:}e.preventDefault()}this.showConsentError=function(e){activeContext=t,null!=e&&(o=e),n&&n(),$(".consent-section").empty(),$(".consent-section").load("features/consent/templates/consent__consents-error.html",function(){t.registerKeyboardEvents(),t.setLabels(),$(".consent-section__banner").show(0),a=window.setTimeout(s,o)})},this.removeKeyboardEvents=function(){keyset.setValue(0),document.removeEventListener("keydown",r),e(),$(".consent-section").empty()},this.registerKeyboardEvents=function(){keyset.setValue(keyset.NAVIGATION),document.addEventListener("keydown",r)},this.setLabels=function(){$(".consent-section__banner__message").html(labelsManager.getLabel("CONSENT_ERROR_OVERLAY_TEXT"))}},ConsentsParametersOverlayComponent=function(e,n){var i=this,l=0,_=-1;function t(){return!(l!=_||!$('.tvium-container [tabindex="'+l+'"]').hasClass("skipfocus"))}function a(e){switch(logManager.log("Keyset check - e.keyCode: "+e.keyCode+" e.code: "+e.code),e.keyCode){case KeyEvent.VK_UP:case e.VK_UP:case VK_UP:t()?i.manageDownKeyEvent(yellowButtonEnabled):i.manageUpKeyEvent(yellowButtonEnabled);break;case KeyEvent.VK_DOWN:case e.VK_DOWN:case VK_DOWN:i.manageDownKeyEvent(yellowButtonEnabled);break;case KeyEvent.VK_RIGHT:case e.VK_RIGHT:case VK_RIGHT:t()?i.manageDownKeyEvent(yellowButtonEnabled):i.manageRightKeyEvent();break;case KeyEvent.VK_LEFT:case e.VK_LEFT:case VK_LEFT:t()?i.manageDownKeyEvent(yellowButtonEnabled):i.manageLeftKeyEvent();break;case KeyEvent.VK_ENTER:case e.VK_ENTER:case VK_ENTER:i.manageEnterKeyEvent(yellowButtonEnabled);break;case KeyEvent.VK_BACK:case e.VK_BACK:case VK_BACK:i.manageBackKeyEvent()}e.preventDefault()}this.init=function(e){i.consentModel=e},this.showConsentParametersOverlay=function(c){activeContext=i,e&&e(),$(".consent-section").load("features/consent/templates/consent__consents-parameters-overlay.html",function(){try{if(i.registerKeyboardEvents(),i.setLabels(),$("#confirmButtonAll").html(labelsManager.getLabel("CONSENT_PARAMETERS_OVERLAY_CONFIRM_ALL")),$("#refuserButtonAll").html(labelsManager.getLabel("CONSENT_PARAMETERS_OVERLAY_REFUSER_ALL")),$("#politique").html(labelsManager.getLabel("CONSENT_DIRECT_VALIDATION_OVERLAY_LEFT_TEXT_DOWN_POLITIQUE")),$("#partenaires").html(labelsManager.getLabel("CONSENT_DIRECT_VALIDATION_OVERLAY_LEFT_TEXT_DOWN_PARTENAIRES")),null!=i.consentModel.consents){var e="",n=3,t=" active";i.auxConsentModel=JSON.parse(JSON.stringify(i.consentModel));for(var a=0;a<i.consentModel.consents.length;a++){var o,s=i.consentModel.consents[a],r="";null!=c&&1==c?(r=s.modificationText,null!=s.consentStatus&&(o=s.consentStatus)):(r=s.consentText,o=s.consentStatus),e+='<div class="consent-section__page__contain__text">'+r+'</div><div class="consent-section__page__contain__buttons-container"><button class="consent-section__page__contain__buttons-container__button button '+(5<=n&&1!=c?" disabled":"")+(1==o?t:"")+'" id="t'+a+'" name="'+labelsManager.getLabel("CONSENT_PARAMETERS_OVERLAY_YES_BUTTON")+'" value="true" tabindex="'+n+'">'+labelsManager.getLabel("CONSENT_PARAMETERS_OVERLAY_YES_BUTTON")+"</button>",e+='<button class="consent-section__page__contain__buttons-container__button button '+(5<=++n&&1!=c?" disabled":"")+(0==o?t:"")+'" id="f'+a+'" name="'+labelsManager.getLabel("CONSENT_PARAMETERS_OVERLAY_NO_BUTTON")+'" value="false" tabindex="'+n+'">'+labelsManager.getLabel("CONSENT_PARAMETERS_OVERLAY_NO_BUTTON")+"</button></div>",n++}$(".consent-section__page__contain__buttons-container-all").after(e)}consent.getConfiguration().CONSENT_PARAMETERS_DEFAULT_FOCUS&&(_=Number(consent.getConfiguration().CONSENT_PARAMETERS_DEFAULT_FOCUS)),null!=c&&1==c?($("#confirmButton").focus(),$("#confirmButton").addClass("focused"),$("#headerText").html(labelsManager.getLabel("CONSENT_MODIFICATION_OVERLAY_HEADER_TEXT")),l=parseInt($("#confirmButton").attr("tabindex"))):(l=_,$('.tvium-container [tabindex="'+l+'"]').addClass("focused"),$("#headerText").html(labelsManager.getLabel("CONSENT_PARAMETERS_OVERLAY_HEADER_TEXT")),$(".consent-section__page__contain__message").html(labelsManager.getLabel("CONSENT_DIRECT_VALIDATION_OVERLAY_LEFT_TEXT")))}catch(e){logManager.error(e.message)}})},this.manageRightKeyEvent=function(){var e;try{e="Oui"==$(".focused").attr("name")||"rowbutton"==$(".focused").attr("name")&&11!=l?1:-1==l?2:0,$("*").removeClass("focused"),l+=e,$('.tvium-container [tabindex="'+l+'"]').hasClass("skipfocus")&&l++,$('.tvium-container [tabindex="'+l+'"]').addClass("focused")}catch(e){logManager.error(e.message)}},this.manageLeftKeyEvent=function(){try{"Non"==$(".focused").attr("name")||11==l?l-=1:"Oui"==$(".focused").attr("name")&&$(".focused").hasClass("all")?l+=9:0,$("*").removeClass("focused"),$('.tvium-container [tabindex="'+l+'"]').hasClass("skipfocus")&&l--,$('.tvium-container [tabindex="'+l+'"]').addClass("focused")}catch(e){logManager.error(e.message)}},this.manageUpKeyEvent=function(e){var n;try{-1!=l&&0!=l?(n="rowbutton"==$(".focused").attr("name")?$("*").hasClass("disabled")?11==l?10:9:11==l?2:1:"Non"==$(".focused").attr("name")?3:2,$("*").removeClass("focused"),l-=n):n=0,$('.tvium-container [tabindex="'+l+'"]').hasClass("skipfocus")&&l--,$('.tvium-container [tabindex="'+l+'"]').addClass("focused")}catch(e){logManager.error(e.message)}},this.manageDownKeyEvent=function(e){var n;try{0!=(n=l==_&&$('.tvium-container [tabindex="'+l+'"]').hasClass("skipfocus")?1:"Oui"==$(".focused").attr("name")&&$('.tvium-container [tabindex="'+(l+2)+'"]').hasClass("button")&&!$('.tvium-container [tabindex="'+(l+2)+'"]').hasClass("disabled")||-1==l?2:"Non"==$(".focused").attr("name")&&$('.tvium-container [tabindex="'+(l+2)+'"]').hasClass("button")&&!$('.tvium-container [tabindex="'+(l+2)+'"]').hasClass("disabled")||"Valider"==$(".focused").attr("name")?1:"Oui"==$(".focused").attr("name")&&3==$("button.active").length?2:"Non"==$(".focused").attr("name")&&3==$("button.active").length?1:0)&&($("*").removeClass("focused"),l+=n,$('.tvium-container [tabindex="'+l+'"]').hasClass("skipfocus")&&l++,$('.tvium-container [tabindex="'+l+'"]').addClass("focused"))}catch(e){logManager.error(e.message)}},this.manageEnterKeyEvent=null,this.manageBackKeyEvent=null,this.manageShowPrivacyPolicy=null,this.manageShowPartner=null,this.manageShowErrorMessage=null,this.getAuxContentModel=function(){return i.auxConsentModel},this.setEnterKeyEventHandler=function(e){i.manageEnterKeyEvent=e},this.setBackKeyEventHandler=function(e){i.manageBackKeyEvent=e},this.fadeOutError=function(){$(".consent-section__banner").fadeOut(1e3,function(){i.removeKeyboardEvents(),n()})},this.removeKeyboardEvents=function(){keyset.setValue(0),document.removeEventListener("keydown",a),n(),$(".consent-section").empty(),activeContext=null},this.registerKeyboardEvents=function(){keyset.setValue(keyset.NAVIGATION),logManager.log("Keyset bound: keyset.NAVIGATION - "+JSON.stringify(app.privateData.keyset)),document.addEventListener("keydown",a)},this.setLabels=function(){$("#backButton").html(labelsManager.getLabel("CONSENT_PARAMETERS_OVERLAY_BACK_BUTTON")),$("#headerTitle").html(labelsManager.getLabel("CONSENT_PARAMETERS_OVERLAY_TITLE")),$("#headerButton").text(labelsManager.getLabel("CONSENT_PARAMETERS_OVERLAY_LEFT_HEADER_BUTTON")),$("#confirmButton").text(labelsManager.getLabel("CONSENT_PARAMETERS_OVERLAY_LEFT_CONFIRM_BUTTON")),$(".consent-section__page__left__message_down_link_1").html(labelsManager.getLabel("CONSENT_DIRECT_VALIDATION_OVERLAY_LEFT_TEXT_DOWN_LINK_1")),$(".consent-section__page__left__message_down_link_2").html(labelsManager.getLabel("CONSENT_DIRECT_VALIDATION_OVERLAY_LEFT_TEXT_DOWN_LINK_2")),$(".consent-section__page__title_dx").html(labelsManager.getLabel("CONSENT_DIRECT_VALIDATION_OVERLAY_RIGHT_TITLE"))},this.updateModel=function(e){try{i.consentModel=e}catch(e){logManager.error(e.message)}}},ConsentsPartnerComponent=function(e,n){var t=this,a=2,o=0,s="";function r(e){switch(logManager.log("Keyset check - e.keyCode: "+e.keyCode+" e.code: "+e.code),e.keyCode){case KeyEvent.VK_ENTER:case e.VK_ENTER:case VK_ENTER:t.manageEnterKeyEvent();break;case KeyEvent.VK_BACK:case e.VK_BACK:case VK_BACK:t.manageBackKeyEvent();break;case KeyEvent.VK_UP:case e.VK_UP:case VK_UP:t.manageUpKeyEvent();break;case KeyEvent.VK_DOWN:case e.VK_DOWN:case VK_DOWN:t.manageDownKeyEvent();break;case KeyEvent.VK_LEFT:case e.VK_LEFT:case VK_LEFT:t.manageLeftKeyEvent();break;case KeyEvent.VK_RIGHT:case e.VK_RIGHT:case VK_RIGHT:t.manageRightKeyEvent()}e.preventDefault()}this.showConsentPartner=function(n){e&&e(),$(".consent-section").empty(),$(".consent-section").load("features/consent/templates/consent__consents-partenaires.html",function(){t.registerKeyboardEvents(),t.setLabels(),consent.getConfiguration().CONSENT_PARTENAIRES_DEFAULT_FOCUS&&(a=Number(consent.getConfiguration().CONSENT_PARTENAIRES_DEFAULT_FOCUS)),$('.tvium-container [tabindex="'+a+'"]').focus(),$('.tvium-container [tabindex="'+a+'"]').addClass("focused"),n&&""!=n&&(s=n),$("#backButton").attr("pagefrom",s);var e=consent.getConfiguration().PARTNER_API_ENDPOINT;1==consent.getConfiguration().DUMMY_API&&(e+="/getPartnerBannerDummy.json"),$.ajax({type:"GET",url:e,contentType:"application/json",dataType:"json"}).done(function(e,n,t){!function(e){var n="";if(e&&e.PARTNERS){var t=e.PARTNERS,a=Object.keys(t);if(0<a.length){for(var o=0;o<a.length;o++){var s=t[a[o]];n+=function(e,n){for(var t='<div class="consent-section__page__contain__partenaires__partners__partner_item" id="partner_'+n+'"><div class="consent-section__page__contain__partenaires__partners__partner_item__name">'+e.NAME+"</div><span>"+labelsManager.getLabel("CONSENT_PARTENAIRES_FINALITE")+"</span><ul>",a=0;a<e.CONSENTS.length;a++)t+="<li>"+e.CONSENTS[a].CONSENTNAME+"</li>";return t+='</ul><div class="consent-section__page__contain__partenaires__partners__partner_item__link">'+labelsManager.getLabel("CONSENT_PARTENAIRES_SITE")+'<a href="'+e.URL_POLITIQUE+'">'+e.URL_POLITIQUE+"</a></div></div>"}(s,o)}$(".consent-section__page__contain__partenaires--txt").html(labelsManager.getLabel("CONSENT_PARTENAIRES_HEADER_TEXT")),$("#politique").html(labelsManager.getLabel("CONSENT_PARTENAIRES_POLITIQUE")),$(".consent-section__page__contain__partenaires__partners").html(n)}}""==n&&$(".consent-section__page__contain__partenaires--txt").html(labelsManager.getLabel("CONSENT_PARTENAIRES_HEADER_EMPTY_TEXT"))}(e)}).fail(function(e,n,t){logManager.log(t)})})},this.manageEnterKeyEvent=null,this.manageBackKeyEvent=null,this.setEnterKeyEventHandler=function(e){t.manageEnterKeyEvent=e},this.setBackKeyEventHandler=function(e){t.manageBackKeyEvent=e},this.manageLeftKeyEvent=function(){var e;$(".tvium-container .focused")[0]&&"partenairesText"===(e=$(".tvium-container .focused")[0].id)&&($("#backButton").addClass("focused"),$("#"+e).removeClass("focused"))},this.manageRightKeyEvent=function(){var e;$(".tvium-container .focused")[0]&&"backButton"===(e=$(".tvium-container .focused")[0].id)&&($("#partenairesText").addClass("focused"),$("#"+e).removeClass("focused"))},this.manageUpKeyEvent=function(){var e;if($(".tvium-container .focused")[0])switch(e=$(".tvium-container .focused")[0].id){case"partenairesText":$("#partenairesText")[0].scrollTop<=0?($("#backButton").addClass("focused"),$("#"+e).removeClass("focused")):$("#partenairesText")[0].scrollTop=$("#partenairesText")[0].scrollTop-50;break;case"politique":$("#"+e).removeClass("focused"),$("#"+e).removeClass("active"),$("#backButton").addClass("focused")}},this.manageDownKeyEvent=function(){var e,n=$("#partenairesText").height(),t=$(".consent-section__page__contain__partenaires__partners").height()-n;if($(".tvium-container .focused")[0])switch(e=$(".tvium-container .focused")[0].id){case"backButton":$("#partenairesText").addClass("focused"),$("#"+e).removeClass("focused");break;case"partenairesText":50*o<t?($("#partenairesText")[0].scrollTop=$("#partenairesText")[0].scrollTop+50,o+=1):($("#"+e).removeClass("focused"),$("#politique").addClass("focused"),$("#politique").addClass("active"))}},this.removeKeyboardEvents=function(){keyset.setValue(0),document.removeEventListener("keydown",r),n(),$(".consent-section").empty()},this.registerKeyboardEvents=function(){keyset.setValue(keyset.NAVIGATION),document.addEventListener("keydown",r)},this.setLabels=function(){$(".consent-section__page__back-button").html(labelsManager.getLabel("CONSENT_PARTENAIRES_BACK_BUTTON")),$(".consent-section__page__title").html(labelsManager.getLabel("CONSENT_PARTENAIRES_HEADER_TITLE"))}},ConsentsPrivacyPolicyComponent=function(n,e){var t=this,a=0,o=0;function s(e){switch(logManager.log("Keyset check - e.keyCode: "+e.keyCode+" e.code: "+e.code),e.keyCode){case KeyEvent.VK_ENTER:case e.VK_ENTER:case VK_ENTER:t.manageEnterKeyEvent();break;case KeyEvent.VK_BACK:case e.VK_BACK:case VK_BACK:t.manageBackKeyEvent();break;case KeyEvent.VK_UP:case e.VK_UP:case VK_UP:t.manageUpKeyEvent();break;case KeyEvent.VK_DOWN:case e.VK_DOWN:case VK_DOWN:t.manageDownKeyEvent();break;case KeyEvent.VK_LEFT:case e.VK_LEFT:case VK_LEFT:t.manageLeftKeyEvent();break;case KeyEvent.VK_RIGHT:case e.VK_RIGHT:case VK_RIGHT:t.manageRightKeyEvent()}e.preventDefault()}this.showConsentPrivacyPolicy=function(e){n&&n(),$(".consent-section").empty(),$(".consent-section").load("features/consent/templates/consent__consents-privacy-policy.html",function(){t.registerKeyboardEvents(),t.setLabels(),consent.getConfiguration().CONSENT_PRIVACY_DEFAULT_FOCUS&&(o=Number(consent.getConfiguration().CONSENT_PRIVACY_DEFAULT_FOCUS)),a=o,$('.tvium-container [tabindex="'+a+'"]').focus(),$('.tvium-container [tabindex="'+a+'"]').addClass("focused"),$("#backButton").attr("pagefrom",e)})},this.manageEnterKeyEvent=null,this.manageBackKeyEvent=null,this.setEnterKeyEventHandler=function(e){t.manageEnterKeyEvent=e},this.setBackKeyEventHandler=function(e){t.manageBackKeyEvent=e},this.manageLeftKeyEvent=function(){try{0==a&&($("*").removeClass("focused"),a--,$('.tvium-container [tabindex="'+a+'"]').addClass("focused"))}catch(e){logManager.error(e.message)}},this.manageRightKeyEvent=function(){try{-1==a&&($("*").removeClass("focused"),a++,$('.tvium-container [tabindex="'+a+'"]').addClass("focused"))}catch(e){logManager.error(e.message)}},this.manageUpKeyEvent=function(){try{0==a&&($("#privacyPolicyText")[0].scrollTop=$("#privacyPolicyText")[0].scrollTop-50)}catch(e){logManager.error(e.message)}},this.manageDownKeyEvent=function(){try{0==a&&($("#privacyPolicyText")[0].scrollTop=$("#privacyPolicyText")[0].scrollTop+50)}catch(e){logManager.error(e.message)}},this.removeKeyboardEvents=function(){keyset.setValue(0),document.removeEventListener("keydown",s),e(),$(".consent-section").empty()},this.registerKeyboardEvents=function(){keyset.setValue(keyset.NAVIGATION),document.addEventListener("keydown",s)},this.setLabels=function(){$(".consent-section__page__back-button").html(labelsManager.getLabel("CONSENT_PRIVACY_POLICY_BACK_BUTTON")),$(".consent-section__page__title").html(labelsManager.getLabel("CONSENT_PRIVACY_POLICY_HEADER_TITLE")),$(".consent-section__page__contain__politique--upper").html(labelsManager.getLabel("CONSENT_PRIVACY_POLICY_HEADER_TEXT")),$(".consent-section__page__contain__politique--body").html(labelsManager.getLabel("CONSENT_PRIVACY_POLICY_TEXT"))}},ConsentRequests=function(){var c=this,r=0,i=consent.getConfiguration().MAXIMUM_NUMBER_CONSENTS_RETRIES||1;this.getConsentGET=function(a,n){var o="ConsentRequests.getConsent()";logManager.log(o);var e=consent.getConfiguration().CONSENT_API_ENDPOINT;1==consent.getConfiguration().DUMMY_API&&(e+="/getConsentsDummy.json");var t="",s="";null!=consent.getModel()&&null!=consent.getModel().tvId&&(t="tvId="+consent.getModel().tvId,s="?"),logManager.log(o+" "+e+s+t),$.ajax({type:"GET",url:e,data:t,timeout:consent.getConfiguration().GET_CONSENT_CALL_TIMEOUT,success:function(e,n,t){logManager.log(o+" - Response : "+JSON.stringify(e,null,4)),a(e)},error:function(e){r<i?(r++,c.getConsentGET(a,n)):(logManager.error(o+" - Error : "+JSON.stringify(e,null,4)),n())}})},this.getConsentPOST=function(n,t,a,o){var s="ConsentRequests.getConsentPOST()";logManager.log(s),o=o||0;var e=JSON.stringify(a);logManager.log(s+" payload: "+e);var r=consent.getConfiguration().CONSENT_API_ENDPOINT;1==consent.getConfiguration().DUMMY_API&&(r+="/getConsentsDummy.json"),$.ajax({type:"POST",url:r,data:e,contentType:"application/json",dataType:"json",timeout:consent.getConfiguration().SET_CONSENT_CALL_TIMEOUT,success:function(e){logManager.log("Response "+s+": "+JSON.stringify(e,null,4)),("OK"==e.result?n:t)(e)},error:function(e){o<i?(o++,c.getConsentPOST(n,t,a,o)):(logManager.error("Error "+s+": "+JSON.stringify(e,null,4)),t())}})}};