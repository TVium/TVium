var Adv=function(){var n,_=this,T=new AdvHashmap,v=new AdvRequests,h={},d={AdEvent:"ADEVENT",BinaryEvent:"BINARY_EVENT"};this.streamEventsHandlerComponent=new StreamEventsHandlerComponent(r,function e(t,a){try{if(t&&t.name===d.BinaryEvent){if(logManager.log("onBinaryEventReceived: "+u(t)),"error"===t.status)logManager.warning("Event onBinaryEventReceived on error status, re-registering Stream Events listeners."),this.streamEventsHandlerComponent.unregisterStreamEventsListeners(),c();else if("trigger"===t.status){logManager.log("BINARY_EVENT received");var n=new SCTE35Parser;a&&logManager.log("retrying..."),logManager.log("parsing with BASE64");var r=n.parseFromBase64(t.text);logManager.log(JSON.stringify(r));var i=r.descriptors;if(i&&0<i.length){for(var o=0;o<i.length;o++)if(logManager.log(i[o].segmentation_type_id),_.getConfiguration().TRIGGERABLE_FN_ON_SCTE35_MAP&&_.getConfiguration().TRIGGERABLE_FN_ON_SCTE35_MAP[i[o].segmentation_type_id]&&_.getConfiguration().TRIGGERABLE_FN_ON_SCTE35_MAP[i[o].segmentation_type_id].FN){logManager.log("triggerable function by "+i[o].segmentation_type_id+" found");var s={},g=_.getConfiguration().TRIGGERABLE_FN_ON_SCTE35_MAP[i[o].segmentation_type_id].ATTRIBUTES;if(g&&0<g.length)for(var l=0;l<g.length;l++)s[g[l]]=i[o][g[l]];_.getConfiguration().TRIGGERABLE_FN_ON_SCTE35_MAP[i[o].segmentation_type_id].FN(s,r);break}}else a||e(t,!0)}}else t?logManager.warning("onBinaryEventReceived - wrong event Name: "+t.name):logManager.warning("onBinaryEventReceived - payload not defined")}catch(e){logManager.error("onBinaryEventReceived - error: "+e.message)}}),this.ptsHandlerComponent=new PtsHandlerComponent,this.callAdServerRoundTripTime=0;var t={};function c(){logManager.log("Stream Events Listening Method init..."),objVideo=serviceManager.getObjVideo();try{featuresManager.getFeature("streamEventDVBMethod")?(logManager.log("Adv Listening Method: streamEventDVBMethod"),e(_.streamEventsHandlerComponent.registerStreamEventsListeners)):featuresManager.getFeature("streamEventXMLMethod")?(logManager.log("Adv Listening Method: streamEventXMLMethod"),e(_.streamEventsHandlerComponent.registerStreamEventsListeners)):logManager.log("Adv Listening Method: none (as per features file definition)")}catch(e){logManager.error("initStreamEventsMethod: "+e)}}function e(e){objVideo?2===objVideo.playState?(logManager.log("presenting channel ready"),e()):(logManager.log("presenting channel not ready, listen playstateChange"),objVideo.onPlayStateChange=a):logManager.warning("The application is broadcast dependent, try to attach to broadcast")}function a(e,t){switch(e){case 0:logManager.log("state video broadcast: unrealized");break;case 1:logManager.log("state video broadcast: connecting");break;case 2:logManager.log("state video broadcast: presenting"),c(),objVideo.onPlayStateChange=function(){};break;case 3:logManager.log("state video broadcast: stopped")}}function r(e){try{e&&e.name===d.AdEvent?(logManager.log("onAdEventReceived: "+u(e)),"error"===e.status?(logManager.warning("Event onAdEventReceived on error status, re-registering Stream Events listeners."),_.streamEventsHandlerComponent.unregisterStreamEventsListeners(),c()):"trigger"===e.status&&(e.text?JSON.parse(e.text).hasOwnProperty("event_type")?logManager.error("onAdEventReceived - Stream Event ignored."):"spot"===_.getConfiguration().AD_SUBSTITUTION_METHOD?m(e.text):"break"===_.getConfiguration().AD_SUBSTITUTION_METHOD?i(e.text,null):logManager.warning("onAdEventReceived - No SpotMode or BreakMode set in the configuration."):logManager.error("onAdEventReceived - empty payload!"))):e?logManager.warning("onAdEventReceived - wrong event Name: "+e.name):logManager.warning("onAdEventReceived - payload not defined")}catch(e){logManager.error("onAdEventReceived - error: "+e.message)}}function m(e){try{var t=JSON.parse(e);if(t.STARTdata.triplet!==serviceManager.getCurrentChannel().getChannelToString())return void logManager.warning("startEventProcess - event triplet ("+t.STARTdata.triplet+") not corresponding to current channel's triplet ("+serviceManager.getCurrentChannel().getChannelToString()+")");T.getValue(t.STARTdata.break_code)?o(e):_.getConfiguration().CALL_ADSERVER_FALLBACK_ON_STARTEVENT&&"spot"===_.getConfiguration().AD_SUBSTITUTION_METHOD?(logManager.log("startEventProcess - break_code not found in dictionary: triggering callAdServer."),i(e,function(){o(e)})):logManager.warning("startEventProcess - break code not found in dictionary.")}catch(e){logManager.error("startEventProcess - error: "+e.message)}}function i(e,r){try{if(null==featuresManager.getFeature("linearAdTracking")||!0!==featuresManager.getFeature("linearAdTracking"))return void logManager.warning("callAdServerProcess - linearAdTracking feature is not true");if(consent&&(null==consent.getModel()||!0!==consent.getModelConsents().TRACKING.consentStatus))return void logManager.warning("callAdServerProcess - user consent not given to TRACKING");var i=JSON.parse(e);if(0!==Object.keys(h).length&&"break"===_.getConfiguration().AD_SUBSTITUTION_METHOD)return void logManager.warning("callAdServerProcess - Discarding Event: Break tracking already in progress.");if(i.LOADdata.triplet!==serviceManager.getCurrentChannel().getChannelToString())return void logManager.warning("callAdServerProcess - event triplet ("+i.LOADdata.triplet+") not corresponding to current channel's triplet ("+serviceManager.getCurrentChannel().getChannelToString()+")");if(T.isAdvIDExists(i.LOADdata.break_code))return void logManager.warning("callAdServerProcess - break code already loaded");if(T.initialize(i.LOADdata.break_code),T.setStatus(i.LOADdata.break_code,T.lstStatus.LOADING),consent&&null==consent.getModel())return void logManager.warning("callAdServerProcess - getWizadsData() the tvId is not retrived yet");i.LOADdata.channel&&(i.LOADdata.channel=i.LOADdata.channel.toUpperCase());var t=consent?consent.getModel().tvId:"",a=t+(new Date).getTime(),n=i.LOADdata.dai_version,o=i.LOADdata.channel,s=i.LOADdata.break_code,g=i.LOADdata.bday||"",l=i.LOADdata.break_duration,d=core.getPlatform().brand.toLowerCase().trim(),c=_.getConfiguration().AD_SUBSTITUTION_METHOD,u=_.getConfiguration().ADSERVER_URL;u+="?dai_version="+n+"&transaction_id="+a+"&response_type="+c+"&channel="+o+"&break_code="+s+"&break_day="+g+"&break_duration="+l+"&advertising_id="+t+"&platform="+d+"&context=live&current_spot=0";var p=Date.now();v.getWizadsData(u,function(e){var t,a;function n(){logManager.log("breakTracking - Processing break["+t.LOADdata.break_code+"] - Sequence["+a+"] started");var e={LOADdata:t.LOADdata,STARTdata:{break_code:t.STARTdata.break_code,sequence:a,triplet:t.STARTdata.triplet,duration:h.spots[a].duration,pts:0}};null!=h.spots[a+1]&&window.setTimeout(n,h.spots[a].duration+_.getConfiguration().BLACK_FRAMES_DURATION_AFTER_SPOT),m(JSON.stringify(e)),a++}_.callAdServerRoundTripTime=Date.now()-p,0!==Object.keys(e).length?(function(e,t){try{h={},logManager.log("createDictionary() - Creating dictionary");var a=t.Ads;if(0<a.length){h.id=e,logManager.log("createDictionary() - dictionary.id: "+h.id),h.spots=[];for(var n=0;n<a.length;n++)h.spots[parseInt(a[n].Sequence)]=function(e){var t;return(t=function(e){try{var t={},a=e.InLine.Creatives[0].Linear.Duration;t.duration=1e3*+a,t.tracking={};var n=e.InLine.Creatives[0].Linear.TrackingEvents;t.tracking.impression=e.InLine.Impressions[0].Data.trim();for(var r=0;r<n.length;r++)switch(n[r].Event){case"firstQuartile":t.tracking.firstQuartile=n[r].Data.trim();break;case"midpoint":t.tracking.midpoint=n[r].Data.trim();break;case"thirdQuartile":t.tracking.thirdQuartile=n[r].Data.trim();break;case"complete":t.tracking.complete=n[r].Data.trim()}var i=e.InLine.Creatives[0].Linear.MediaFiles[0].Data.trim();return t.media_file_url=i,t.media_file_type="addressed",-1!==i.indexOf("broadcasted")&&(t.media_file_type="broadcasted"),t}catch(e){logManager.error("createTrackingItemsForDictionary: "+e)}}(e)).companionAd=function(e){try{var t={};return t=null!=e.InLine.Creatives[0].CompanionAds?e.InLine.Creatives[0].CompanionAds:t}catch(e){logManager.error("createCompanionAdForDictionary: "+e)}}(e),t}(a[n]),logManager.log("createDictionary() - dictionary.spots["+parseInt(a[n].Sequence)+"] tracking items loaded")}else logManager.log("createDictionary() - no Ads found in VAST file.")}catch(e){logManager.error("createDictionary: "+e)}}(i.LOADdata.break_code,e),T.setValue(i.LOADdata.break_code,h,T.type.STREAMEVENT),T.setStatus(i.LOADdata.break_code,T.lstStatus.LOADED),null!=r&&r(),"break"===_.getConfiguration().AD_SUBSTITUTION_METHOD&&(a=(t=i).STARTdata.sequence,featuresManager.getFeature("PTSMethod")?(logManager.warning("breakTracking - Waiting first START PTS time in order to start tracking queue."),_.ptsHandlerComponent.ptsStartEventTimeCheck(t,n)):(logManager.warning("breakTracking - no PTS or Delay method for this client in the feature file. Queuing starts immediately."),n()))):logManager.log("callAdServerProcess - VAST file is an empty object.")},function(e){f(i.LOADdata.break_code),logManager.error("getWizadsData() KO Response")})}catch(e){logManager.error("callAdServerProcess - error: "+e.message)}}function o(e){var t=JSON.parse(e),a=T.getValue(t.STARTdata.break_code);if(a.status===T.lstStatus.LOADED||a.status===T.lstStatus.STARTED)if(T.setStatus(t.STARTdata.break_code,T.lstStatus.STARTED),h.spots.hasOwnProperty(t.STARTdata.sequence))if(logManager.log("startEventProcessPostValidation - Event payload: "+e),t.STARTdata.duration===h.spots[t.STARTdata.sequence].duration)switch(_.getConfiguration().AD_SUBSTITUTION_METHOD){case"spot":featuresManager.getFeature("PTSMethod")?_.ptsHandlerComponent.ptsStartEventTimeCheck(t,s):logManager.warning("startEventProcess - no PTS or Delay method for this client in the feature file.");break;case"break":s(t);break;default:logManager.warning('startEventProcess - no "break" or "spot" mode enabled.')}else logManager.warning("startEventProcess - spot duration in Stream Event payload ("+t.STARTdata.duration+") not matching the VAST duration for this spot ("+h.spots[t.STARTdata.sequence].duration+")");else logManager.warning("startEventProcess - sequence not found: "+t.STARTdata.sequence);else logManager.warning("startEventProcess - incorrect status : "+a.status)}function s(e){T.getValue(e.STARTdata.break_code)?!consent||null!=consent.getModel()&&!0===consent.getModelConsents().TRACKING.consentStatus?featuresManager.getFeature("linearAdTracking")&&!0===featuresManager.getFeature("linearAdTracking")&&function(t){try{var e,a;null!=h&&0<Object.keys(h).length&&null!=t.STARTdata.sequence&&h.id===t.STARTdata.break_code?(e=h.spots[t.STARTdata.sequence].duration/4,a=0,g(h.spots[t.STARTdata.sequence].tracking.impression,"impression",t.STARTdata.sequence),n=window.setInterval(function(){switch(++a){case 1:g(h.spots[t.STARTdata.sequence].tracking.firstQuartile,"firstQuartile",t.STARTdata.sequence);break;case 2:g(h.spots[t.STARTdata.sequence].tracking.midpoint,"midpoint",t.STARTdata.sequence);break;case 3:g(h.spots[t.STARTdata.sequence].tracking.thirdQuartile,"thirdQuartile",t.STARTdata.sequence);break;case 4:!function(e){g(h.spots[e.STARTdata.sequence].tracking.complete,"complete",e.STARTdata.sequence),n&&window.clearInterval(n);l(e.STARTdata.break_code,e.STARTdata.sequence),logManager.log("Adv pixel tracking schedulation ended.")}(t)}},e)):logManager.warning("scheduleSpotTracking - empty dictionary")}catch(e){logManager.error("scheduleSpotTracking: "+e),l(t.STARTdata.break_code,t.STARTdata.sequence)}}(e):(logManager.warning("startEventCoreProcess - user consent not given to TRACKING"),l(e.STARTdata.break_code,e.STARTdata.sequence)):logManager.warning("startEventCoreProcess - break code not found")}function g(e,t,a){if(trace&&trace.injectTrackingPixel(e),_.getConfiguration().VISIBLE_AD_TRACKING)switch(t){case"impression":case"complete":!function(e,t,a){var n=$(".trackingPopupContainer"),r="5%";1<=n.length&&(r="50%");var i=$("<div class='trackingPopupContainer' style='position:absolute; top:"+r+"; left:65px; width: 50%; padding:5px; z-index: 9999; background-color:rgba(255,255,255,0.7); color:#000; border:1px solid #000; word-break: break-all;'><b>Sequence: </b>"+a+"<br /><b>Tracking: </b>"+$.camelCase(e)+"<br /><b>URL: </b> "+escapeXml(t)+"</div>");$(".tvium-container").append(i),window.setTimeout(function(){i.remove()},3e3)}(t,e,a)}logManager.log("Sequence["+a+"] - "+t+" pixel image loaded - "+escapeXml(e))}function l(e,t){h.spots.hasOwnProperty(t)?(delete h.spots[t],0===Object.keys(h.spots).length&&(f(e),T.clearLst(),h={},logManager.log("All spots of the break has been removed!"))):logManager.warning("removeSpotFromDictionary - "+t+" not found")}function f(e){T.isAdvIDExists(e)?(T.setStatus(e,T.lstStatus.STOP),T.deleteAdv(e)):logManager.warning("clearAdv - event ID not found")}function u(e){var t="";try{var a=JSON.stringify(e,null,4),t="{}"===a?"Status:"+e.status+" - Text: "+e.text:a}catch(e){}return t}return{configure:function(e){t=e},getConfiguration:function(){return t},initStreamEventsMethod:c,onAdEventReceived:r,callAdServerProcess:i,startProcess:m,registerStreamEventsListeners:this.streamEventsHandlerComponent.registerStreamEventsListeners,unregisterStreamEventsListeners:this.streamEventsHandlerComponent.unregisterStreamEventsListeners}},AdvHashmap=function(){var n={status:null,dictionary:null},a=null,r={LOADING:"LOADING",LOADED:"LOADED",STARTING:"STARTING",STARTED:"STARTED",STOP:"STOP"};function i(e){return e in n}return{deleteAdv:function(e){delete n[e],logManager.log("deleteAdv -  Adv Deleted!")},initialize:function(e){n[e.toString()]={status:null,dictionary:null}},setValue:function(e,t,a){i(e)||(n[e]={}),n[e].dictionary=t,n[e].type=a},getValue:function(e){return i(e)?n[e]:null},setStatus:function(e,t){i(e)?(n[e].status=t)==r.STARTING?a=e:t==r.STOP&&(a=null,logManager.log("Status: "+t)):logManager.warning("Adv ID not found: "+e)},isAdvIDExists:i,isAdvAlreadyStarted:function(){return null!=a},lstStatus:r,type:{STREAMEVENT:"STREAMEVENT"},clearLst:function(){n={},a=null},lstAdvIsEmpty:function(){return 0==Object.keys(n).length||0==Object.keys(n).length}}},AdvRequests=function(){var s=0;this.getWizadsData=function(n,r,i){var o="AdvRequests.getWizadsData()",e=n;logManager.log(o+" CALLED - url: "+n),$.ajax({type:"GET",contentType:"application/json",dataType:"json",url:e,timeout:adv.getConfiguration().GET_WIZADS_TIMEOUT,success:function(e,t,a){logManager.log(o+" - Response : OK"),r(e)},error:function(e,t,a){logManager.error(o+" - Error : "+JSON.stringify(a,null,4)),"timeout"===t&&s<1&&(s++,self.getWizadsData(n,r,i)),i()}})}},PtsHandlerComponent=function(){this.ptsStartEventTimeCheck=function(a,n){null!=mediaSyncManager.getCurrentTime()?(logManager.log("ptsStartEventTimeCheck - currentTime: "+mediaSyncManager.getCurrentTime()+" - PTS check starting in "+(a.STARTdata.pts-mediaSyncManager.getCurrentTime()-adv.getConfiguration().PTS_CHECK_START_TIME-featuresManager.getFeature("ptsSpotModeSwitchInDurationFineTuning"))+"Ms."),setTimeout(function(){var t=setInterval(function(){var e=mediaSyncManager.getCurrentTime();logManager.log("MediaSynchroniser.currentTime = "+e+" - Event PTS time = "+a.STARTdata.pts+" - Time difference = "+(Math.abs(a.STARTdata.pts-e)-featuresManager.getFeature("ptsSpotModeSwitchInDurationFineTuning"))),a.STARTdata.pts-e-featuresManager.getFeature("ptsSpotModeSwitchInDurationFineTuning")+adv.getConfiguration().PTS_CHECK_TOLERANCE<0&&(logManager.warning("ptsStartEventTimeCheck - payload PTS already expired. We can't go back in time Morty!"),window.clearInterval(t)),Math.abs(a.STARTdata.pts-e-featuresManager.getFeature("ptsSpotModeSwitchInDurationFineTuning"))<=adv.getConfiguration().PTS_CHECK_TOLERANCE&&(n(a),window.clearInterval(t))},adv.getConfiguration().PTS_CHECK_INTERVAL_TIME+featuresManager.getFeature("PTSCheckIntervalFineTuning"))},a.STARTdata.pts-mediaSyncManager.getCurrentTime()-adv.getConfiguration().PTS_CHECK_START_TIME-featuresManager.getFeature("ptsSpotModeSwitchInDurationFineTuning"))):logManager.error("ptsStartEventTimeCheck - MediaSynchroniser not available")}};function SCTE35Parser(){this.init=function(){this.scte35_bitarray=new Array,this.spliceInfo={}},this.parseFromBase64=function(e){this.init();for(var t=window.atob(e),a=t.length,n=new Uint8Array(new ArrayBuffer(a)),r=0;r<a;r++)n[r]=t.charCodeAt(r),this.writeToBitArray(n[r]);return this.parse(),this.spliceInfo},this.parseFromHex=function(e){if(this.init(),!e||e.length<0)return"no data";for(var t=0;t<e.length;t+=2){parseInt("0x"+e[t]+e[t+1]);this.writeToBitArray(parseInt(e[t]+e[t+1],16))}return this.parse(),this.spliceInfo},this.parse=function(){var e=this.read(8);if(252==e){var t=this.spliceInfo;t.table_id=e,t.section_syntax_indicator=this.read(1),t.private_indicator=this.read(1),this.read(2),t.section_length=this.read(12),t.protocol_version=this.read(8),t.encrypted_packet=this.read(1),t.encryption_algorithm=this.read(6),t.pts_adjustment=this.read(33),t.cw_index=this.read(8),t.tier=this.read(12),t.splice_command_length=this.read(12),t.splice_command_type=this.read(8),0==t.splice_command_type?this.parse_splice_null():4==t.splice_command_type?this.parse_splice_schedule():5==t.splice_command_type?(t.splice_command_type_text="splice_insert",this.parse_splice_insert()):6==t.splice_command_type?(t.splice_command_type_text="time_signal",this.parse_time_signal()):7==t.splice_command_type?this.bandwidth_reservation():6==t.splice_command_type&&this.parse_private_command(),t.descriptor_loop_length=this.read(16),t.descriptors=[];for(var a=this.scte35_bitarray.length,n=0;n<t.descriptor_loop_length&&!(a-this.scte35_bitarray.length>=8*t.descriptor_loop_length);n++){var r={};if(r.splice_descriptor_tag=this.read(8),r.descriptor_length=this.read(8),r.identifier=this.read(32),1129661769==r.identifier){switch(r.splice_descriptor_tag){case 0:case 1:break;case 2:if(r.segmentation_event_id=this.read(32),r.segmentation_event_cancel_indicator=this.read(1),r.reserved=this.read(7),"0"==r.segmentation_event_cancel_indicator&&(r.program_segmentation_flag=this.read(1),r.segmentation_duration_flag=this.read(1),r.delivery_not_restricted_flag=this.read(1),"0"==r.delivery_not_restricted_flag?(r.web_delivery_allowed_flag=this.read(1),r.no_regional_blackout_flag=this.read(1),r.archive_allowed_flag=this.read(1),r.device_restrictions=this.read(2)):r.reserved=this.read(5),"0"==r.program_segmentation_flag)){r.component_count=this.read(8),r.components=[];for(var i=0;i<r.component_count;i++){var o={};o.component_tag=this.read(8),o.reserved=this.read(7),o.pts_offset=this.read(33),r.components.push(o)}}switch("1"==r.segmentation_duration_flag&&(r.segmentation_duration=this.read(40)),r.segmentation_upid_type=this.read(8),r.segmentation_upid_length=this.read(8),this.parse_segmentation_upid(r),r.segmentation_type_id=this.read(8),r.segmentation_type_id){case 0:logManager.log("Type = Not Indicated\n");break;case 1:logManager.log("Type = Content Identification\n");break;case 16:logManager.log("Type = Program Start\n");break;case 17:logManager.log("Type = Program End\n");break;case 18:logManager.log("Type = Program Early Termination\n");break;case 19:logManager.log("Type = Program Breakaway\n");break;case 20:logManager.log("Type = Program Resumption\n");break;case 21:logManager.log("Type = Program Runover Planned\n");break;case 22:logManager.log("Type = Program Runover Unplanned\n");break;case 23:logManager.log("Type = Program Overlap Start\n");break;case 32:logManager.log("Type = Chapter Start\n");break;case 33:logManager.log("Type = Chapter End\n");break;case 48:logManager.log("Type = Provider Advertisement Start\n");break;case 49:logManager.log("Type = Provider Advertisement End\n");break;case 50:logManager.log("Type = Distributor Advertisement Start\n");break;case 51:logManager.log("Type = Distributor Advertisement End\n");break;case 52:logManager.log("Type = Placement Opportunity Start\n");break;case 53:logManager.log("Type = Placement Opportunity End\n");break;case 64:logManager.log("Type = Unscheduled Event Start\n");break;case 65:logManager.log("Type = Unscheduled Event End\n");break;case 80:logManager.log("Type = Network Start\n");break;case 81:logManager.log("Type = Network End\n");break;default:logManager.log("Type = Unknown = "+r.segmentation_type_id+"\n")}r.segment_num=this.read(8),r.segments_expected=this.read(8)}t.descriptors.push(r)}else this.read(8*r.descriptor_length-32)}}},this.parse_splice_null=function(){throw"command_type splice_null not supported yet"},this.parse_splice_schedule=function(){throw"command_type splice_schedule not supported yet"},this.parse_splice_insert=function(){var e={};(this.spliceInfo.splice_event=e).splice_event_id=this.read(32),e.splice_event_cancel_indicator=this.read(1),this.read(7),0==e.splice_event_cancel_indicator&&(e.out_of_network_indicator=this.read(1),e.program_splice_flag=this.read(1),e.duration_flag=this.read(1),e.splice_immediate_flag=this.read(1),this.read(4),1==e.program_splice_flag&&0==e.splice_immediate_flag&&this.parse_splice_time(this.spliceInfo.splice_event),1==e.duration_flag&&this.parse_break_duration(),e.unique_program_id=this.read(16),e.avail_num=this.read(8),e.avails_expected=this.read(8))},this.parse_time_signal=function(){var e={};this.spliceInfo.splice_event=e,this.parse_splice_time(e)},this.parse_bandwidth_reservation=function(){throw"command_type bandwidth_reservation not supported yet"},this.parse_private_command=function(){throw"command_type private_command not supported yet"},this.parse_splice_time=function(e){e.time_specified_flag=this.read(1),1==e.time_specified_flag?(this.read(6),e.pts_time=this.read(33)):this.read(7)},this.parse_break_duration=function(){var e={};(this.spliceInfo.splice_event.break_duration=e).auto_return=this.read(1),e.reserved=this.read(6),e.duration=this.read(33)},this.parse_segmentation_upid=function(e){switch(e.segmentation_upid_type){case 0:case 8:break;case 12:e.segmentation_upid=this.read(e.segmentation_upid_length)}},this.writeToBitArray=function(e){for(var t=128,a=0;a<8;a++)this.scte35_bitarray[this.scte35_bitarray.length]=t&e?!0:!1,t>>=1},this.read=function(e){var t=this.scte35_bitarray.splice(0,e),a=0;if(32<e){for(var n=0;n<e-32;n++)a<<=1,t.shift()&&(a+=1);a*=Math.pow(2,32),e=32}for(var r=0,n=0;n<e;n++)r<<=1,t.shift()&&(r+=1);return 32<=e&&(r>>>=0),a+r},this.test=function(e){e=e||"fc302000000000000000fff00f05000000007fcfffa7f7abd400680001000088f3ebaf",logManager.log("testString = "+e);e=this.parseFromHex(e);logManager.log(this.scte35_array),logManager.log(JSON.stringify(e))}}var StreamEventsHandlerComponent=function(e,t){var a=null;this.registerStreamEventsListeners=function(){try{null!=(a=function(){var e=null;{if(featuresManager.getFeature("streamEventDVBMethod")){var t=null,a=null;try{var n=objVideo.currentChannel;n?(t=n.onid.toString(16)+"."+n.tsid.toString(16)+"."+n.sid.toString(16),logManager.log("current channel ID(hex) = "+t+", type=null, name="+n.name)):logManager.warning("currentChannel not defined")}catch(e){throw logManager.error("getUrlStreamEventObj: "+e),e}return serviceManager.getCurrentChannel()&&(e=serviceManager.getCurrentChannel().getChannelToString(),null==adv.getConfiguration().STREAM_EVENT_CONFIGURATION[e]?logManager.warning("getUrlStreamEventObj - No DVB STREAM EVENT CONFIGURATION for this channel ("+e+")"):a="dvb://"+t+"."+adv.getConfiguration().STREAM_EVENT_CONFIGURATION[e].DVB_OBJECT_CAROUSEL_COMPONENT_TAG.toString(16)+"/"+adv.getConfiguration().STREAM_EVENT_CONFIGURATION[e].DVB_STREAM_EVENTS_OBJECT_NAME),a}if(featuresManager.getFeature("streamEventXMLMethod"))return serviceManager.getCurrentChannel()&&(e=serviceManager.getCurrentChannel().getChannelToString()),logManager.log(adv.getConfiguration().STREAM_EVENT_CONFIGURATION[e].XML_STREAM_EVENTS_XML_DEFINITION),adv.getConfiguration().STREAM_EVENT_CONFIGURATION[e].XML_STREAM_EVENTS_XML_DEFINITION}}())?(logManager.log("streamEventObjectURL: "+a),objVideo.addStreamEventListener(a,"ADEVENT",e),logManager.log("ADEVENT Registered"),objVideo.addStreamEventListener(a,"BINARY_EVENT",t),logManager.log("BINARY_EVENT Registered")):logManager.warning("registerEvents: Stream Events Listeners not registered, no Carousel definition for this channel")}catch(e){logManager.error("registerEvents: "+e)}},this.unregisterStreamEventsListeners=function(){logManager.log("Stream event Unregistering...");try{e&&objVideo.removeStreamEventListener(a,"ADEVENT",e),logManager.log("ADEVENT Unregistered"),t&&objVideo.removeStreamEventListener(a,"BINARY_EVENT",t),logManager.log("BINARY_EVENT Unregistered")}catch(e){logManager.error("Error on Stream event Unregistered: "+e.message)}logManager.log("Stream event Unregistered")}};