var VK_LEFT,VK_UP,VK_RIGHT,VK_DOWN,VK_ENTER,VK_RED,VK_GREEN,VK_YELLOW,VK_BLUE,VK_PLAY,VK_PAUSE,VK_STOP,VK_FAST_FWD,VK_REWIND,VK_BACK,VK_0,VK_1,VK_2,VK_3,VK_4,VK_5,VK_6,VK_7,VK_8,VK_9;function extend(e,n){for(var t in n)n.hasOwnProperty(t)&&(e[t]=n[t]);return e}function escapeXml(e){if(null!=e)return e.replace(/[<>&'"]/g,function(e){switch(e){case"<":return"&lt;";case">":return"&gt;";case"&":return"&amp;";case"'":return"&apos;";case'"':return"&quot;"}})}Core=function(){var t={brand:"",model:"",hbbtvversion:""},o={};this.configure=function(e){o=e},this.getConfiguration=function(){return o},this.initPlatformData=function(){var e,n=window.navigator.userAgent.match(/HbbTV\/\d\.(\d).(\d)/g)[0];n&&(t.hbbtvversion=n,(n=window.navigator.userAgent.substring(window.navigator.userAgent.indexOf(n)+n.length).match(/\(([^)]+)\)/)[1])&&(e=n.split(";"))),e&&2<=e.length&&(t.brand=e[1]),e&&3<=e.length&&(t.model=e[2])},this.getPlatform=function(){return t},this.loadRemoteAppConfiguration=function(n,t){try{logManager.generalLog(o.CONFIG_FILE+" loading..."),$.ajax({type:"GET",url:o.CONFIG_FILE,contentType:"application/json",dataType:"json",timeout:o.CONFIG_FILE_TIMEOUT,success:function(e){logManager.generalLog(o.CONFIG_FILE+" LOADED!"),o=extend(e,Constants),logManager.generalLog("Server config file and app config file are merged"),logManager.generalLog(JSON.stringify(o,null,4)),n()},error:function(e){logManager.generalError(o.CONFIG_FILE+" ERROR!");e=JSON.stringify(e);logManager.generalError(o.CONFIG_FILE+" ERROR DESC:"+e),t(e)}})}catch(e){t(e.message)}},this.setConfiguration=function(e,n){null!=o&&(o[e]=n)}},void 0===VK_LEFT&&(VK_LEFT=37,VK_UP=38,VK_RIGHT=39,VK_DOWN=40),void 0===VK_ENTER&&(VK_ENTER=13),void 0===VK_RED&&(VK_RED=82,VK_GREEN=86,VK_YELLOW=74,VK_BLUE=66),void 0===VK_PLAY&&(VK_PLAY=80,VK_PAUSE=81,VK_STOP=83),void 0===VK_FAST_FWD&&(VK_FAST_FWD=70,VK_REWIND=82),void 0===VK_BACK&&(VK_BACK=166),void 0===VK_0&&(VK_0=48,VK_1=49,VK_2=50,VK_3=51,VK_4=52,VK_5=53,VK_6=54,VK_7=55,VK_8=56,VK_9=57),Element.prototype.addClass=function(e){$(this).addClass(e)},Element.prototype.removeClass=function(e){$(this).removeClass(e)},Number.prototype.padLeft=function(e,n){e=String(e||10).length-String(this).length+1;return 0<e?new Array(e).join(n||"0")+this:this},String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}),Object.keys||(Object.keys=function(){"use strict";var r=Object.prototype.hasOwnProperty,a=!{toString:null}.propertyIsEnumerable("toString"),i=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],g=i.length;return function(e){if("object"!=typeof e&&("function"!=typeof e||null===e))throw new TypeError("Object.keys called on non-object");var n,t,o=[];for(n in e)r.call(e,n)&&o.push(n);if(a)for(t=0;t<g;t++)r.call(e,i[t])&&o.push(i[t]);return o}}());var Channel=function(e){var n=e;this.getChannelObj=function(){return n},this.getChannelToString=function(){return n&&n.onid||(logManager.log("current channel obj is null or has no triplet - reloading current channel obj from broadcast object"),n=serviceManager.getObjVideo().currentChannel,logManager.log("new channel obj: "+n)),n.onid+"."+n.tsid+"."+n.sid},this.isChannelEqualTo=function(e){return e.getChannelToString()===n.getChannelToString()}},FeaturesManager=function(){var a;this.loadFeaturesConfiguration=function(r){$.ajax({type:"GET",url:core.getConfiguration().FEATURES_FILE,contentType:"application/json",dataType:"json"}).done(function(e,n,t){try{for(var o=0;o<e.devices.length;o++)if(null==e.devices[o].userAgentInfo.brand.trim()&&(e.devices[o].userAgentInfo.brand=""),null==e.devices[o].userAgentInfo.model.trim()&&(e.devices[o].userAgentInfo.model=""),null==e.devices[o].userAgentInfo.others.trim()&&(e.devices[o].userAgentInfo.others=""),null!=window.navigator.userAgent&&-1<window.navigator.userAgent.toUpperCase().indexOf(e.devices[o].userAgentInfo.brand.toUpperCase().trim())&&-1<window.navigator.userAgent.toUpperCase().indexOf(e.devices[o].userAgentInfo.model.toUpperCase().trim())&&-1<window.navigator.userAgent.toUpperCase().indexOf(e.devices[o].userAgentInfo.others.toUpperCase().trim())){a=e.devices[o].features,logManager.log('Brand matching: "'+e.devices[o].userAgentInfo.brand.trim()+'"\nModel matching: "'+e.devices[o].userAgentInfo.model.trim()+'"\nOthers matching: "'+e.devices[o].userAgentInfo.others.trim()+'"\nFeatures loaded: '+JSON.stringify(a,null,4));break}null!=a&&""!==a||logManager.warning("Client not found in Features Whitelist. User Agent: "+window.navigator.userAgent),r()}catch(e){logManager.generalError(e.message)}}).fail(function(e,n,t){logManager.log(t)})},this.getFeature=function(e){return null!=a[e]?a[e]:a},this.setFeature=function(e,n){null!=a[e]&&(a[e]=n)}},KonamiManager=function(){var t={EDIT_CONSENT:{pattern:""+KeyEvent.VK_YELLOW,code:function(){!0===yellowButtonEnabled&&(consent.consentsParametersOverlayComponent.init(consent.getModel()),consent.consentsParametersOverlayComponent.showConsentParametersOverlay(yellowButtonEnabled))}},SWITCH_LOGS:{pattern:""+KeyEvent.VK_BLUE+KeyEvent.VK_GREEN+KeyEvent.VK_RED+KeyEvent.VK_RED+KeyEvent.VK_GREEN+KeyEvent.VK_BLUE,code:function(){"block"===document.getElementById("logContainer").style.display?logManager.hideLogOverlay():logManager.showLogOverlay()}}};return{loadKonamis:function(){for(var e in t)t.hasOwnProperty(e)&&(n=t[e],e=void 0,(e=new Konami).pattern=n.pattern,e.code=n.code,e.load());var n}}},LabelsManager=function(){var o;this.init=function(){$.ajax({type:"GET",url:core.getConfiguration().LANG_FOLDER+"/labels."+core.getConfiguration().LANGUAGE+".json",contentType:"application/json",dataType:"json"}).done(function(e,n,t){o=e}).fail(function(e,n,t){logManager.log(t)})},this.getLabel=function(e){return null!=o[e]?o[e].replace("\n","<br />"):""}},LogManager=function(){var t=!0;return{generalLog:function(e){var n=[(n=new Date).getHours().padLeft(),n.getMinutes().padLeft(),n.getSeconds().padLeft(),n.getMilliseconds().padLeft()].join(":")+" - "+e,e=$("#logContainer"),n=n.replace(/&/g,"#");e.append("<p class='colorLogWithEvidence' "+(t?"style='background-color: rgba(0, 0, 0, 0.8);'":"")+">"+n+"<br/></p>"),e.scrollTop(e.prop("scrollHeight")),console.log(n),t=!t},log:function(e){var n;1==core.getConfiguration().ENABLE_LOGS&&(n=[(n=new Date).getHours().padLeft(),n.getMinutes().padLeft(),n.getSeconds().padLeft(),n.getMilliseconds().padLeft()].join(":")+" - "+e,e=$("#logContainer"),n=n.replace(/&/g,"#"),e.append("<p class='colorLogWithEvidence' "+(t?"style='background-color: rgba(0, 0, 0, 0.8);'":"")+">"+n+"<br/></p>"),e.scrollTop(e.prop("scrollHeight")),console.log(n),t=!t)},generalError:function(e){var n=(n=[(n=new Date).getHours().padLeft(),n.getMinutes().padLeft(),n.getSeconds().padLeft(),n.getMilliseconds().padLeft()].join(":")+" -  ERROR: "+e).replace(/&/g,"#");(e=$("#logContainer")).append("<p class='colorLogError' >"+n+"<br/></p>"),e.scrollTop(e.prop("scrollHeight")),console.error(n)},error:function(e){var n;1==core.getConfiguration().ENABLE_LOGS&&(n=(n=[(n=new Date).getHours().padLeft(),n.getMinutes().padLeft(),n.getSeconds().padLeft(),n.getMilliseconds().padLeft()].join(":")+" - ERROR: "+e).replace(/&/g,"#"),(e=$("#logContainer")).append("<p class='colorLogError' >"+n+"<br/></p>"),e.scrollTop(e.prop("scrollHeight")),console.error(n))},warning:function(e){var n;1==core.getConfiguration().ENABLE_LOGS&&(n=(n=[(n=new Date).getHours().padLeft(),n.getMinutes().padLeft(),n.getSeconds().padLeft(),n.getMilliseconds().padLeft()].join(":")+" - WARNING: "+e).replace(/&/g,"#"),(e=$("#logContainer")).append("<p class='colorLogWarning'>"+n+"<br/></p>"),e.scrollTop(e.prop("scrollHeight")),console.warn(n))},showLogOverlay:function(){$("#logContainer").css("display","block"),null!=core.getConfiguration().ENABLE_LOGS&&(core.getConfiguration().ENABLE_LOGS=!0,core.configure(core.getConfiguration()))},hideLogOverlay:function(){$("#logContainer").css("display","none"),null!=core.getConfiguration().ENABLE_LOGS&&(core.getConfiguration().ENABLE_LOGS=!1,core.configure(core.getConfiguration()))}}},MediaSyncManager=function(){var e,n=["urn:dvb:css:timeline:pts"],t=!1,o=function(){try{if("function"!=typeof window.vb.addEventListener)return void logManager.error("mediaSyncManager - video/broadcast.addEventListener() not a function");if("function"!=typeof window.vb.onPlayStateChange&&logManager.log("mediaSyncManager - onPlayStateChange not available"),window.vb.onPlayStateChange=a,"function"!=typeof window.vb.bindToCurrentChannel)return void logManager.error("mediaSyncManager - video/broadcast.bindToCurrentChannel() not a function");logManager.log("mediaSyncManager - Waiting for v/b object to transition to 'presenting' state...")}catch(e){logManager.error("mediaSyncManager - "+e)}},r=!1,a=function(){try{logManager.log("mediaSyncManager - video/broadcast.playState: "+g(window.vb.playState)),2!==window.vb.playState||r||(i(),r=!0)}catch(e){logManager.error("mediaSyncManager"-e)}},i=function(){try{if("function"!=typeof window.msync.addEventListener)return void logManager.error("mediaSyncManager - MediaSynchroniser.addEventListener() not a function");if(window.msync.addEventListener("error",function(e){try{logManager.error("mediaSyncManager - MediaSynchroniser error code: "+window.msync.lastError)}catch(e){logManager.error("mediaSyncManager - "+e)}}),logManager.log("mediaSyncManager - Calling MediaSynchroniser.initMediaSynchroniser() timelineSelector="+e),"function"!=typeof window.msync.initMediaSynchroniser)return void logManager.error("mediaSyncManager - MediaSynchroniser.initMediaSynchroniser() not a function. Broadcast Timecode reading not supported.");window.msync.initMediaSynchroniser(window.vb,e),logManager.log("mediaSyncManager - MediaSynchroniser initialised."),t=!0}catch(e){logManager.error(e)}},g=function(e){switch(e){case 0:return"0 (unrealized)";case 1:return"1 (connecting)";case 2:return"2 (presenting)";case 3:return"3 (stopped)";default:return String(e)+" (unrecognised)"}};return{init:function(){e=n[0],window.msync=document.getElementById("msync"),window.vb=document.getElementById("video"),void 0===window.msync||void 0===window.vb?logManager.error("mediaSyncManager - Could not obtain MediaSynchroniser or v/b objects."):(2===window.vb.playState?i:o)()},getCurrentTime:function(){return t&&null!=window.msync&&null!=window.msync.currentTime?Math.trunc(1e3*window.msync.currentTime):(logManager.error("mediaSyncManager not ready yet."),null)}}},ServiceManager=function(){var a=null,n=null;function e(e){n=new Channel(e)}function t(e){e=e.onid+"."+e.tsid+"."+e.sid;getChannelToString()!=e&&app.destroyApplication()}function o(e,n){logManager.log("onChannelChangeError() - "+n+" - playstate:"+function(){if(a)try{return r(a.playState)}catch(e){return" error: "+e.message}else logManager.warning("The application is broadcast indipendet, press GREEN button to attach to broadcast")}())}function r(e){return 0==e?"Unrelized":1==e?"Connecting":2==e?"Presenting":3==e?"stopped":"not defined: "+e}return{initialize:function(){try{if(a=document.getElementById("video")){if(logManager.log("binding.. to current channel"),featuresManager.getFeature("bindToCurrentChannel"))try{a.bindToCurrentChannel(),logManager.log("objVideo.bindToCurrentChannel() executed correctly")}catch(e){logManager.error("Error executing bindToCurrentChannel() method. Channel data not retrieved.")}logManager.log("setting.. full screen"),a.setFullScreen(!1),logManager.log("attaching.. to onChannelChangeSucceeded event"),a.onChannelChangeSucceeded=t,logManager.log("attaching.. to onChannelChangeKO event"),a.onChannelChangeError=o,logManager.log("attaching.. to onPlayStateChange event"),a.onPlayStateChange=function(e,n){n?logManager.log("onPlayStateChange() - new state: "+r(e)+" - error:"+n):logManager.log("onPlayStateChange() - new state: "+r(e))},logManager.log("saving.. the current triplet"),e(a.currentChannel)}else logManager.log("html tag 'video' broadcast not found")}catch(e){logManager.error("ServiceManager.initialize() - "+e.message)}},setChannel:function(n,t,o){var e,r=null;logManager.log("change channel to:"+n+"."+t+"."+o);try{a?e=a.getChannelConfig().channelList:logManager.warning("The application is broadcast indipendet, press GREEN button to attach to broadcast")}catch(e){throw logManager.warning("get channelList failed ",e),e}try{r=e.getChannelByTriplet(n,t,o)}catch(e){throw logManager.warning("getChannelByTriplet failed for "+n+"."+t+"."+o,e),e}try{logManager.log("Setting channel, waiting for onChannelChangeSucceeded..."),a.setChannel(r,!1)}catch(e){throw logManager.warning("setChannel("+r+") failed",e),e}},getObjVideo:function(){return a},bindToCurrentChannel:function(){try{a.bindToCurrentChannel(),logManager.log("objVideo binded")}catch(e){logManager.log("bindToCurrentChannel ERROR: "+e.message)}},setFullScreen:function(){try{a.setFullScreen(!0),logManager.log("setFullScreen ok")}catch(e){logManager.log("setFullScreen ERROR: "+e.message)}},stopBroadcast:function(){if(a)try{a.stop(),logManager.log("broadcast stopped")}catch(e){logManager.warning("stopBroadcast() - error:"+e.message)}else logManager.error("stopBroadcast() - objVideo broadcast not set")},startBroadcast:function(){if(a)try{a.bindToCurrentChannel(),logManager.log("broadcast binded")}catch(e){logManager.warning("startBroadcast() - error:"+e.message)}else logManager.error("startBroadcast() - objVideo broadcast not set")},getCurrentChannel:function(){return n},setCurrentChannel:e,resizeBroadcast:function(e){var n=document.getElementById("video");try{e?(n.style.width="1280px",n.style.height="720px"):(n.style.width="960px",n.style.height="540px")}catch(e){logManager.warning("Exception toggling fullscreen : ",e)}}}},StorageManager=function(){this.setCookie=function(e,n){var t=this.getCookie("consentDate"),o="",r=window.location.hostname;null!=t?o=" expires="+new Date(parseInt(t)).toUTCString()+";":(t=new Date,o=" expires="+(t=new Date(t.setMonth(t.getMonth()+core.getConfiguration().COOKIES_MONTHS_DURATION))).toUTCString()+";",document.cookie="consentDate="+escape(t.getTime())+"; domain = "+r+";"+o+" path=/",this.getCookie("consentDate")||(document.cookie="consentDate="+escape(t.getTime())+";"+o+" path=/")),document.cookie=e+"="+escape(n)+"; domain = "+r+";"+o+" path=/",this.getCookie(e)||(logManager.warning("cookie "+e+" creation failed. (domain used: "+r+")"),document.cookie=e+"="+escape(n)+";"+o+" path=/",logManager.warning("cookie "+e+" creation without domain succeeded"))},this.getCookie=function(e){e=document.cookie.match(new RegExp(e+"=([^;]+)"));return e?unescape(e[1]):null}};