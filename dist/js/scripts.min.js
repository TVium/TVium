var VK_LEFT,VK_UP,VK_RIGHT,VK_DOWN,VK_ENTER,VK_RED,VK_GREEN,VK_YELLOW,VK_BLUE,VK_PLAY,VK_PAUSE,VK_STOP,VK_FAST_FWD,VK_REWIND,VK_BACK,VK_0,VK_1,VK_2,VK_3,VK_4,VK_5,VK_6,VK_7,VK_8,VK_9,Constants={VERSION:"0.1.0",CONFIG_FILE:"config/hbbtvConfig.json",CONFIG_FILE_TIMEOUT:3e4,LANG_FOLDER:"config/languages",CONSENT_BANNER_DISPLAY_TIME:1e4,CONSENT_CONFIRMATION_DISPLAY_TIME:5e3,COOKIES_MONTHS_DURATION:6,MODEL_COOKIE_NAME:"appData",AD_SUBSTITUTION_METHOD:"break",CALL_ADSERVER_FALLBACK_ON_STARTEVENT:!0,STREAM_EVENT_CONFIGURATION:{"399.5.2":{NAME:"name",DVB_STREAM_EVENTS_OBJECT_NAME:"object_name",DVB_OBJECT_CAROUSEL_COMPONENT_TAG:100,CHANNEL_NAME:"channel_name",XML_STREAM_EVENTS_XML_DEFINITION:"filepath/file.xml"}}};void 0===VK_LEFT&&(VK_LEFT=37,VK_UP=38,VK_RIGHT=39,VK_DOWN=40),void 0===VK_ENTER&&(VK_ENTER=13),void 0===VK_RED&&(VK_RED=82,VK_GREEN=86,VK_YELLOW=74,VK_BLUE=66),void 0===VK_PLAY&&(VK_PLAY=80,VK_PAUSE=81,VK_STOP=83),void 0===VK_FAST_FWD&&(VK_FAST_FWD=70,VK_REWIND=82),void 0===VK_BACK&&(VK_BACK=166),void 0===VK_0&&(VK_0=48,VK_1=49,VK_2=50,VK_3=51,VK_4=52,VK_5=53,VK_6=54,VK_7=55,VK_8=56,VK_9=57);var app=null,logManager=null,konamiManager=null,serviceManager=null,mediaSyncManager=null,traceManager=null,consentManager=null,configManager=null,storageManager=null,labelsManager=null,featuresManager=null,keyset=null,trackingConsent=null,yellowButtonEnabled=!1,advManager=null,activeContext=null;function extend(e,n){for(var t in n)n.hasOwnProperty(t)&&(e[t]=n[t]);return e}function escapeXml(e){if(null!=e)return e.replace(/[<>&'"]/g,function(e){switch(e){case"<":return"&lt;";case">":return"&gt;";case"&":return"&amp;";case"'":return"&apos;";case'"':return"&quot;"}})}window.onload=function(){try{(logManager=new LogManager).generalLog("User Agent - "+navigator.userAgent),logManager.generalLog("App Host - "+window.location.host);try{var e=document.getElementById("appMan");(app=e.getOwnerApplication(document)).show(),keyset=app.privateData.keyset}catch(e){logManager.generalError(e.message)}try{(configManager=new ConfigurationManager).initPlatformData(),logManager.generalLog("HbbTvVersion: "+configManager.getPlatform().hbbtvversion+" - Brand: "+configManager.getPlatform().brand+" - Model: "+configManager.getPlatform().model),configManager.loadRemoteAppConfiguration(function(){(featuresManager=new FeaturesManager).loadFeaturesConfiguration(function(){(serviceManager=new ServiceManager).initialize(),mediaSyncManager=new MediaSyncManager,featuresManager.getFeature("PTSMethod")&&mediaSyncManager.init(),(labelsManager=new LabelsManager).init(),traceManager=new TraceManager,featuresManager.getFeature("periodicHeartbeat")&&traceManager.startHeartbeat(),storageManager=new StorageManager,logManager.log("getConsent wait-time started"),(consentManager=new ConsentManager(t,n)).init(),setTimeout(function(){consentManager.loadConsentData(function(e){consentManager.consentsDirectValidationOverlayComponent.showConsentDirectValidationOverlay(e)},function(e){(advManager=new AdvManager).initStreamEventsMethod()})},configManager.getConfigurations().TIME_BEFORE_CONSENT_CALL)})},function(e){logManager.generalError(e)})}catch(e){logManager.generalError(e.message)}(konamiManager=new KonamiManager).loadKonamis(),n();try{logManager.generalLog("Keyset bound: "+JSON.stringify(keyset,null,4)+" - Example key (yellow button): "+keyset.YELLOW)}catch(e){logManager.generalError("Init Keyset: "+e.message)}}catch(e){logManager.generalError("General Error: "+e.message)}function n(){try{var e=keyset.YELLOW;keyset.setValue(e)}catch(e){logManager.generalError("General Error: "+e.message)}}function t(){try{keyset.setValue(0)}catch(e){logManager.generalError("General Error: "+e.message)}}},Element.prototype.addClass=function(e){$(this).addClass(e)},Element.prototype.removeClass=function(e){$(this).removeClass(e)},Number.prototype.padLeft=function(e,n){e=String(e||10).length-String(this).length+1;return 0<e?new Array(e).join(n||"0")+this:this},String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}),Object.keys||(Object.keys=function(){"use strict";var o=Object.prototype.hasOwnProperty,r=!{toString:null}.propertyIsEnumerable("toString"),s=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],i=s.length;return function(e){if("object"!=typeof e&&("function"!=typeof e||null===e))throw new TypeError("Object.keys called on non-object");var n,t,a=[];for(n in e)o.call(e,n)&&a.push(n);if(r)for(t=0;t<i;t++)o.call(e,s[t])&&a.push(s[t]);return a}}());var Channel=function(e){var n=e;this.getChannelObj=function(){return n},this.getChannelToString=function(){return n&&n.onid||(logManager.log("current channel obj is null or has no triplet - reloading current channel obj from broadcast object"),n=serviceManager.getObjVideo().currentChannel,logManager.log("new channel obj: "+n)),n.onid+"."+n.tsid+"."+n.sid},this.isChannelEqualTo=function(e){return e.getChannelToString()===n.getChannelToString()}};ConfigurationManager=function(){var r=null,s=null,t={brand:"",model:"",hbbtvversion:""};this.initPlatformData=function(){var e,n=window.navigator.userAgent.match(/HbbTV\/\d\.(\d).(\d)/g)[0];n&&(t.hbbtvversion=n,(n=window.navigator.userAgent.substring(window.navigator.userAgent.indexOf(n)+n.length).match(/\(([^)]+)\)/)[1])&&(e=n.split(";"))),e&&2<=e.length&&(t.brand=e[1]),e&&3<=e.length&&(t.model=e[2])},this.getPlatform=function(){return t},this.loadRemoteAppConfigurationPromise=function(){return new Promise(function(a,o){try{$.ajax({type:"GET",url:Constants.CONFIG_FILE,contentType:"application/json",dataType:"json",timeout:Constants.CONFIG_FILE_TIMEOUT}).done(function(e,n,t){r=e,logManager.log("remoteConfiguration:"+JSON.stringify(e,null,4)),s=Object.assign(r,Constants),logManager.log(JSON.stringify(s,null,4)),a()}).fail(function(e,n,t){e=n+" - "+JSON.stringify(e.responseJSON);o(serviceName+" - KO "+e)})}catch(e){o(e.message)}})},this.loadRemoteAppConfiguration=function(n,t){try{logManager.generalLog(Constants.CONFIG_FILE+" loading..."),$.ajax({type:"GET",url:Constants.CONFIG_FILE,contentType:"application/json",dataType:"json",timeout:Constants.CONFIG_FILE_TIMEOUT,success:function(e){logManager.generalLog(Constants.CONFIG_FILE+" LOADED!"),s=extend(r=e,Constants),logManager.generalLog("Server config file and app config file are merged"),logManager.generalLog(JSON.stringify(s,null,4)),n()},error:function(e){logManager.generalError(Constants.CONFIG_FILE+" ERROR!");e=JSON.stringify(e);logManager.generalError(Constants.CONFIG_FILE+" ERROR DESC:"+e),t(e)}})}catch(e){t(e.message)}},this.getConfigurations=function(){return s},this.setConfigurations=function(e,n){null!=s&&(s[e]=n)}};var FeaturesManager=function(){var r;this.loadFeaturesConfiguration=function(o){$.ajax({type:"GET",url:configManager.getConfigurations().FEATURES_FILE,contentType:"application/json",dataType:"json"}).done(function(e,n,t){try{for(var a=0;a<e.devices.length;a++)if(null==e.devices[a].userAgentInfo.brand.trim()&&(e.devices[a].userAgentInfo.brand=""),null==e.devices[a].userAgentInfo.model.trim()&&(e.devices[a].userAgentInfo.model=""),null==e.devices[a].userAgentInfo.others.trim()&&(e.devices[a].userAgentInfo.others=""),null!=window.navigator.userAgent&&-1<window.navigator.userAgent.toUpperCase().indexOf(e.devices[a].userAgentInfo.brand.toUpperCase().trim())&&-1<window.navigator.userAgent.toUpperCase().indexOf(e.devices[a].userAgentInfo.model.toUpperCase().trim())&&-1<window.navigator.userAgent.toUpperCase().indexOf(e.devices[a].userAgentInfo.others.toUpperCase().trim())){r=e.devices[a].features,logManager.log('Brand matching: "'+e.devices[a].userAgentInfo.brand.trim()+'"\nModel matching: "'+e.devices[a].userAgentInfo.model.trim()+'"\nOthers matching: "'+e.devices[a].userAgentInfo.others.trim()+'"\nFeatures loaded: '+JSON.stringify(r,null,4));break}null!=r&&""!==r||logManager.warning("Client not found in Features Whitelist. User Agent: "+window.navigator.userAgent),o()}catch(e){logManager.generalError(e.message)}}).fail(function(e,n,t){logManager.log(t)})},this.getFeature=function(e){return null!=r[e]?r[e]:r},this.setFeature=function(e,n){null!=r[e]&&(r[e]=n)}},KonamiManager=function(){var t={EDIT_CONSENT:{pattern:""+KeyEvent.VK_YELLOW,code:function(){!0===yellowButtonEnabled&&(consentManager.consentsParametersOverlayComponent.init(consentManager.getModel()),consentManager.consentsParametersOverlayComponent.showConsentParametersOverlay(yellowButtonEnabled))}}};return{loadKonamis:function(){for(var e in t)t.hasOwnProperty(e)&&(n=t[e],e=void 0,(e=new Konami).pattern=n.pattern,e.code=n.code,e.load());var n}}},LabelsManager=function(){var a;this.init=function(){$.ajax({type:"GET",url:Constants.LANG_FOLDER+"/labels."+configManager.getConfigurations().LANGUAGE+".json",contentType:"application/json",dataType:"json"}).done(function(e,n,t){a=e}).fail(function(e,n,t){logManager.log(t)})},this.getLabel=function(e){return null!=a[e]?a[e].replace("\n","<br />"):""}},LogManager=function(){return{generalLog:function(e){var n=new Date,e=(e=[n.getHours().padLeft(),n.getMinutes().padLeft(),n.getSeconds().padLeft(),n.getMilliseconds().padLeft()].join(":")+" - "+e).replace(/&/g,"#");console.log(e)},log:function(e){var n;null!=configManager&&1==configManager.getConfigurations().ENABLE_LOGS&&(e=(e=[(n=new Date).getHours().padLeft(),n.getMinutes().padLeft(),n.getSeconds().padLeft(),n.getMilliseconds().padLeft()].join(":")+" - "+e).replace(/&/g,"#"),console.log(e))},generalError:function(e){var n=new Date,e=(e=[n.getHours().padLeft(),n.getMinutes().padLeft(),n.getSeconds().padLeft(),n.getMilliseconds().padLeft()].join(":")+" -  ERROR: "+e).replace(/&/g,"#");console.error(e)},error:function(e){var n;null!=configManager&&1==configManager.getConfigurations().ENABLE_LOGS&&(e=(e=[(n=new Date).getHours().padLeft(),n.getMinutes().padLeft(),n.getSeconds().padLeft(),n.getMilliseconds().padLeft()].join(":")+" - ERROR: "+e).replace(/&/g,"#"),console.error(e))},warning:function(e){var n;configManager&&1==configManager.getConfigurations().ENABLE_LOGS&&(e=(e=[(n=new Date).getHours().padLeft(),n.getMinutes().padLeft(),n.getSeconds().padLeft(),n.getMilliseconds().padLeft()].join(":")+" - WARNING: "+e).replace(/&/g,"#"),console.warn(e))}}},MediaSyncManager=function(){var e,n=["urn:dvb:css:timeline:pts"],t=!1,a=function(){try{if("function"!=typeof window.vb.addEventListener)return void logManager.error("mediaSyncManager - video/broadcast.addEventListener() not a function");if("function"!=typeof window.vb.onPlayStateChange&&logManager.log("mediaSyncManager - onPlayStateChange not available"),window.vb.onPlayStateChange=r,"function"!=typeof window.vb.bindToCurrentChannel)return void logManager.error("mediaSyncManager - video/broadcast.bindToCurrentChannel() not a function");logManager.log("mediaSyncManager - Waiting for v/b object to transition to 'presenting' state...")}catch(e){logManager.error("mediaSyncManager - "+e)}},o=!1,r=function(){try{logManager.log("mediaSyncManager - video/broadcast.playState: "+i(window.vb.playState)),2!==window.vb.playState||o||(s(),o=!0)}catch(e){logManager.error("mediaSyncManager"-e)}},s=function(){try{if("function"!=typeof window.msync.addEventListener)return void logManager.error("mediaSyncManager - MediaSynchroniser.addEventListener() not a function");if(window.msync.addEventListener("error",function(e){try{logManager.error("mediaSyncManager - MediaSynchroniser error code: "+window.msync.lastError)}catch(e){logManager.error("mediaSyncManager - "+e)}}),logManager.log("mediaSyncManager - Calling MediaSynchroniser.initMediaSynchroniser() timelineSelector="+e),"function"!=typeof window.msync.initMediaSynchroniser)return void logManager.error("mediaSyncManager - MediaSynchroniser.initMediaSynchroniser() not a function. Broadcast Timecode reading not supported.");window.msync.initMediaSynchroniser(window.vb,e),logManager.log("mediaSyncManager - MediaSynchroniser initialised."),t=!0}catch(e){logManager.error(e)}},i=function(e){switch(e){case 0:return"0 (unrealized)";case 1:return"1 (connecting)";case 2:return"2 (presenting)";case 3:return"3 (stopped)";default:return String(e)+" (unrecognised)"}};return{init:function(){e=n[0],window.msync=document.getElementById("msync"),window.vb=document.getElementById("video"),void 0===window.msync||void 0===window.vb?logManager.error("mediaSyncManager - Could not obtain MediaSynchroniser or v/b objects."):(2===window.vb.playState?s:a)()},getCurrentTime:function(){return t&&null!=window.msync&&null!=window.msync.currentTime?Math.trunc(1e3*window.msync.currentTime):(logManager.error("mediaSyncManager not ready yet."),null)}}},ServiceManager=function(){var r=null,n=null;function e(e){n=new Channel(e)}function t(e){e=e.onid+"."+e.tsid+"."+e.sid;getChannelToString()!=e&&app.destroyApplication()}function a(e,n){logManager.log("onChannelChangeError() - "+n+" - playstate:"+function(){if(r)try{return o(r.playState)}catch(e){return" error: "+e.message}else logManager.warning("The application is broadcast indipendet, press GREEN button to attach to broadcast")}())}function o(e){return 0==e?"Unrelized":1==e?"Connecting":2==e?"Presenting":3==e?"stopped":"not defined: "+e}return{initialize:function(){try{if(r=document.getElementById("video")){if(logManager.log("binding.. to current channel"),featuresManager.getFeature("bindToCurrentChannel"))try{r.bindToCurrentChannel(),logManager.log("objVideo.bindToCurrentChannel() executed correctly")}catch(e){logManager.error("Error executing bindToCurrentChannel() method. Channel data not retrieved.")}logManager.log("setting.. full screen"),r.setFullScreen(!1),logManager.log("attaching.. to onChannelChangeSucceeded event"),r.onChannelChangeSucceeded=t,logManager.log("attaching.. to onChannelChangeKO event"),r.onChannelChangeError=a,logManager.log("attaching.. to onPlayStateChange event"),r.onPlayStateChange=function(e,n){n?logManager.log("onPlayStateChange() - new state: "+o(e)+" - error:"+n):logManager.log("onPlayStateChange() - new state: "+o(e))},logManager.log("saving.. the current triplet"),e(r.currentChannel)}else logManager.log("html tag 'video' broadcast not found")}catch(e){logManager.error("ServiceManager.initialize() - "+e.message)}},setChannel:function(n,t,a){var e,o=null;logManager.log("change channel to:"+n+"."+t+"."+a);try{r?e=r.getChannelConfig().channelList:logManager.warning("The application is broadcast indipendet, press GREEN button to attach to broadcast")}catch(e){throw logManager.warning("get channelList failed ",e),e}try{o=e.getChannelByTriplet(n,t,a)}catch(e){throw logManager.warning("getChannelByTriplet failed for "+n+"."+t+"."+a,e),e}try{logManager.log("Setting channel, waiting for onChannelChangeSucceeded..."),r.setChannel(o,!1)}catch(e){throw logManager.warning("setChannel("+o+") failed",e),e}},getObjVideo:function(){return r},bindToCurrentChannel:function(){try{r.bindToCurrentChannel(),logManager.log("objVideo binded")}catch(e){logManager.log("bindToCurrentChannel ERROR: "+e.message)}},setFullScreen:function(){try{r.setFullScreen(!0),logManager.log("setFullScreen ok")}catch(e){logManager.log("setFullScreen ERROR: "+e.message)}},stopBroadcast:function(){if(r)try{r.stop(),logManager.log("broadcast stopped")}catch(e){logManager.warning("stopBroadcast() - error:"+e.message)}else logManager.error("stopBroadcast() - objVideo broadcast not set")},startBroadcast:function(){if(r)try{r.bindToCurrentChannel(),logManager.log("broadcast binded")}catch(e){logManager.warning("startBroadcast() - error:"+e.message)}else logManager.error("startBroadcast() - objVideo broadcast not set")},getCurrentChannel:function(){return n},setCurrentChannel:e}},StorageManager=function(){this.setCookie=function(e,n){var t=this.getCookie("consentDate"),a="",o=window.location.hostname;null!=t?a=" expires="+new Date(parseInt(t)).toUTCString()+";":(t=new Date,a=" expires="+(t=new Date(t.setMonth(t.getMonth()+configManager.getConfigurations().COOKIES_MONTHS_DURATION))).toUTCString()+";",document.cookie="consentDate="+escape(t.getTime())+"; domain = "+o+";"+a+" path=/",this.getCookie("consentDate")||(document.cookie="consentDate="+escape(t.getTime())+";"+a+" path=/")),document.cookie=e+"="+escape(n)+"; domain = "+o+";"+a+" path=/",this.getCookie(e)||(logManager.warning("cookie "+e+" creation failed. (domain used: "+o+")"),document.cookie=e+"="+escape(n)+";"+a+" path=/",logManager.warning("cookie "+e+" creation without domain succeeded"))},this.getCookie=function(e){e=document.cookie.match(new RegExp(e+"=([^;]+)"));return e?unescape(e[1]):null}},ConsentManager=function(e,n){var o=this,s=null;this.consentsDirectValidationOverlayComponent=new ConsentsDirectValidationOverlayComponent(e,n),this.consentsConfirmationOverlayComponent=new ConsentsConfirmationOverlayComponent(e,n),this.consentsParametersOverlayComponent=new ConsentsParametersOverlayComponent(e,n),this.consentsPrivacyPolicyComponent=new ConsentsPrivacyPolicyComponent(e,n),this.consentsPartnerComponent=new ConsentsPartnerComponent(e,n),this.consentsErrorComponent=new ConsentsErrorComponent(e,n),this.init=function(){var e=storageManager.getCookie(configManager.getConfigurations().MODEL_COOKIE_NAME);null!=e&&(s=JSON.parse(e))},this.editAllConsentAndSend=function(e,n){for(var t=0;t<s.consents.length;t++)s.consents[t].consentStatus=e;o.sendConsents(function(e){n.removeKeyboardEvents(),o.consentsConfirmationOverlayComponent.showConsentConfirmationOverlay(null!=e&&null!=e?e:null)},function(){logManager.error("postConsent Error"),n.removeKeyboardEvents(),o.consentsErrorComponent.showConsentError()})},this.consentsDirectValidationOverlayComponent.setEnterKeyEventHandler(function(){try{switch(o.consentsDirectValidationOverlayComponent.getCurrentPosition()){case 0:o.editAllConsentAndSend(!0,o.consentsDirectValidationOverlayComponent);break;case 1:o.editAllConsentAndSend(!1,o.consentsDirectValidationOverlayComponent);break;case 2:o.consentsDirectValidationOverlayComponent.removeKeyboardEvents(),o.consentsParametersOverlayComponent.init(s),o.consentsParametersOverlayComponent.showConsentParametersOverlay(yellowButtonEnabled);break;case 3:o.consentsDirectValidationOverlayComponent.manageShowPrivacyPolicy();break;case 4:o.consentsDirectValidationOverlayComponent.manageShowPartner()}}catch(e){logManager.error(e.message)}}),this.consentsDirectValidationOverlayComponent.manageShowPrivacyPolicy=function(){o.consentsDirectValidationOverlayComponent.removeKeyboardEvents(),o.consentsPrivacyPolicyComponent.showConsentPrivacyPolicy("validation")},this.consentsDirectValidationOverlayComponent.manageShowPartner=function(){o.consentsDirectValidationOverlayComponent.removeKeyboardEvents(),o.consentsPartnerComponent.showConsentPartner("validation")},this.consentsPrivacyPolicyComponent.setEnterKeyEventHandler(function(){var e,n;$(".tvium-container .focused")[0]&&(e=$(".tvium-container .focused")[0].id,n=$("#backButton").attr("pagefrom"),"backButton"===e&&(o.consentsPrivacyPolicyComponent.removeKeyboardEvents(),"validation"==n?o.consentsDirectValidationOverlayComponent.showConsentDirectValidationOverlay():"parameters"==n?o.consentsParametersOverlayComponent.showConsentParametersOverlay(yellowButtonEnabled):"partenaires"==n&&o.consentsPartnerComponent.showConsentPartner("")))}),this.consentsPrivacyPolicyComponent.setBackKeyEventHandler(function(){var e=$("#backButton").attr("pagefrom");o.consentsPrivacyPolicyComponent.removeKeyboardEvents(),"validation"==e?o.consentsDirectValidationOverlayComponent.showConsentDirectValidationOverlay():"parameters"==e?o.consentsParametersOverlayComponent.showConsentParametersOverlay(yellowButtonEnabled):"partenaires"==e&&o.consentsPartnerComponent.showConsentPartner("")}),this.consentsPartnerComponent.setEnterKeyEventHandler(function(){if($(".tvium-container .focused")[0]){var e=$(".tvium-container .focused")[0].id,n=$("#backButton").attr("pagefrom");switch(e){case"backButton":o.consentsPartnerComponent.removeKeyboardEvents(),"validation"==n?o.consentsDirectValidationOverlayComponent.showConsentDirectValidationOverlay():"parameters"==n&&o.consentsParametersOverlayComponent.showConsentParametersOverlay(yellowButtonEnabled);break;case"politique":o.consentsPartnerComponent.removeKeyboardEvents(),o.consentsPrivacyPolicyComponent.showConsentPrivacyPolicy("partenaires")}}}),this.consentsPartnerComponent.setBackKeyEventHandler(function(){var e=$("#backButton").attr("pagefrom");o.consentsPartnerComponent.removeKeyboardEvents(),"validation"==e?o.consentsDirectValidationOverlayComponent.showConsentDirectValidationOverlay():"parameters"==e&&o.consentsParametersOverlayComponent.showConsentParametersOverlay(yellowButtonEnabled)}),this.consentsParametersOverlayComponent.manageShowPrivacyPolicy=function(e){o.consentsParametersOverlayComponent.removeKeyboardEvents(),o.consentsPrivacyPolicyComponent.showConsentPrivacyPolicy("parameters")},this.consentsParametersOverlayComponent.manageShowPartner=function(e){o.consentsParametersOverlayComponent.removeKeyboardEvents(),o.consentsPartnerComponent.showConsentPartner("parameters")},this.consentsParametersOverlayComponent.manageShowErrorMessage=function(){o.consentsParametersOverlayComponent.removeKeyboardEvents();var e=null;null!=s.toRequest&&null!=s.toRequest&&(e=s.toRequest),o.consentsErrorComponent.showConsentError(e)},this.consentsParametersOverlayComponent.setEnterKeyEventHandler(function(e){var n,t,a;try{"Oui"!=$(".focused").attr("name")&&"Non"!=$(".focused").attr("name")||$(".focused").hasClass("all")?"Oui"!=$(".focused").attr("name")&&"Non"!=$(".focused").attr("name")||!$(".focused").hasClass("all")?"Valider"==$(".focused").attr("name")?o.sendConsents(function(e){o.consentsParametersOverlayComponent.removeKeyboardEvents(),o.consentsConfirmationOverlayComponent.showConsentConfirmationOverlay(null!=e&&null!=e?e:null)},function(){logManager.error("postConsent Error"),s=JSON.parse(JSON.stringify(o.consentsParametersOverlayComponent.getAuxContentModel())),o.consentsParametersOverlayComponent.updateModel(s),o.consentsParametersOverlayComponent.removeKeyboardEvents(),o.consentsErrorComponent.showConsentError()}):$("#backButton").hasClass("focused")?((a=null)!=s.toRequest&&null!=s.toRequest&&(a=s.toRequest),1==yellowButtonEnabled?(s=JSON.parse(JSON.stringify(o.consentsParametersOverlayComponent.getAuxContentModel())),o.consentsParametersOverlayComponent.updateModel(s),o.consentsParametersOverlayComponent.removeKeyboardEvents()):(s=JSON.parse(JSON.stringify(o.consentsParametersOverlayComponent.getAuxContentModel())),o.consentsParametersOverlayComponent.updateModel(s),o.consentsParametersOverlayComponent.removeKeyboardEvents(),o.consentsDirectValidationOverlayComponent.showConsentDirectValidationOverlay(a))):$("#politique").hasClass("focused")?(s=JSON.parse(JSON.stringify(o.consentsParametersOverlayComponent.getAuxContentModel())),o.consentsParametersOverlayComponent.updateModel(s),o.consentsParametersOverlayComponent.manageShowPrivacyPolicy("parameters")):$("#partenaires").hasClass("focused")&&(s=JSON.parse(JSON.stringify(o.consentsParametersOverlayComponent.getAuxContentModel())),o.consentsParametersOverlayComponent.updateModel(s),o.consentsParametersOverlayComponent.manageShowPartner("parameters")):"Oui"==$(".focused").attr("name")?o.editAllConsentAndSend(!0,o.consentsParametersOverlayComponent):o.editAllConsentAndSend(!1,o.consentsParametersOverlayComponent):($(".focused").parent().nextAll(".consent-section__page__contain__buttons-container").first().children().removeClass("disabled"),0<$(".focused").parent().children(".active").length&&$(".focused").parent().children().removeClass("active"),$(".focused").addClass("active"),t=(n=$(".focused")[0].id).replace("t","").replace("f",""),parameterValue="t"==n.charAt(0),o.consentsParametersOverlayComponent.manageDownKeyEvent(),s.consents[parseInt(t)].consentStatus=parameterValue,o.consentsParametersOverlayComponent.updateModel(s))}catch(e){logManager.error(e.message)}}),this.consentsParametersOverlayComponent.setBackKeyEventHandler(function(){try{var e=null;null!=s.toRequest&&null!=s.toRequest&&(e=s.toRequest),1==yellowButtonEnabled?(s=JSON.parse(JSON.stringify(o.consentsParametersOverlayComponent.getAuxContentModel())),o.consentsParametersOverlayComponent.updateModel(s),o.consentsParametersOverlayComponent.removeKeyboardEvents()):(s=JSON.parse(JSON.stringify(o.consentsParametersOverlayComponent.getAuxContentModel())),o.consentsParametersOverlayComponent.updateModel(s),o.consentsParametersOverlayComponent.removeKeyboardEvents(),o.consentsDirectValidationOverlayComponent.showConsentDirectValidationOverlay(e))}catch(e){logManager.error(e.message)}}),this.loadConsentData=function(o,r){(new ConsentRequests).getConsentGET(function(e){s=e,storageManager.setCookie(configManager.getConfigurations().MODEL_COOKIE_NAME,JSON.stringify(s));for(var n=!0,t=0;t<e.consents.length;t++)"TRACKING"==e.consents[t].purposeName&&(trackingConsent=e.consents[t].consentStatus),null==e.consents[t].consentStatus&&(n=!1);var a=0!=e.toRequest;a?o(e.toRequest):1==n&&(yellowButtonEnabled=!0),r(a)},function(){logManager.error("getConsent Error")})},this.sendConsents=function(n,e){try{for(var t=o.parseModelForPost(s),a=0;a<s.consents.length;a++)"TRACKING"==s.consents[a].purposeName&&(trackingConsent=s.consents[a].consentStatus);(new ConsentRequests).getConsentPOST(function(e){storageManager.setCookie(configManager.getConfigurations().MODEL_COOKIE_NAME,JSON.stringify(consentManager.getModel())),n(e.toAcknowledge)},function(){e()},t)}catch(e){logManager.error(e.message)}},this.parseModelForPost=function(e){try{for(var n={tvId:consentManager.getModel().tvId,consents:[]},t=0;t<e.consents.length;t++){var a={purposeName:e.consents[t].purposeName,consentStatus:e.consents[t].consentStatus,purposeId:e.consents[t].purposeId};n.consents.push(a)}return n}catch(e){logManager.error(e.message)}},this.getModel=function(){return s},this.getModelConsents=function(){for(var e=[],n=0;n<s.consents.length;n++){var t={purposeName:s.consents[n].purposeName,consentStatus:s.consents[n].consentStatus,purposeId:s.consents[n].purposeId};e[s.consents[n].purposeName]=t}return e}},ConsentsConfirmationOverlayComponent=function(n,e){var t=Constants.CONSENT_CONFIRMATION_DISPLAY_TIME;function a(){$(".consent-section__banner").hide(0,function(){e(),$(".consent-section").empty()})}this.showConsentConfirmationOverlay=function(e){null!=e&&(t=e),n&&n(),$(".consent-section").load("features/consent/templates/consent__consents-confirmation-overlay.html",function(){$(".consent-section__banner__message").html(labelsManager.getLabel("CONSENT_CONFIRMATION_OVERLAY_TEXT")),$(".consent-section__banner").show(0,function(){yellowButtonEnabled=!0,keyDownTimeout=window.setTimeout(a,t)})})}},ConsentsDirectValidationOverlayComponent=function(n,e){var t=this,a=null,o=Constants.CONSENT_BANNER_DISPLAY_TIME,r=0,s=0;function i(){$(".consent-section__banner").hide(0,function(){t.removeKeyboardEvents(),e(),$(".consent-section").empty()})}function c(e){switch(window.clearTimeout(a),logManager.log("Keyset check - e.keyCode: "+e.keyCode+" e.code: "+e.code),e.keyCode){case KeyEvent.VK_UP:case e.VK_UP:case VK_UP:t.manageUpKeyEvent();break;case KeyEvent.VK_DOWN:case e.VK_DOWN:case VK_DOWN:t.manageDownKeyEvent();break;case KeyEvent.VK_RIGHT:case e.VK_RIGHT:case VK_RIGHT:t.manageRightKeyEvent();break;case KeyEvent.VK_LEFT:case e.VK_LEFT:case VK_LEFT:t.manageLeftKeyEvent();break;case KeyEvent.VK_ENTER:case e.VK_ENTER:case VK_ENTER:t.manageEnterKeyEvent()}e.preventDefault()}this.showConsentDirectValidationOverlay=function(e){null!=e&&(o=e),n&&n(),$(".consent-section").load("features/consent/templates/consent__consents-direct-validation-overlay.html",function(){t.registerKeyboardEvents(),t.setLabels(),$(".consent-section__banner").show(0,function(){configManager.getConfigurations().CONSENT_DIRECT_DEFAULT_FOCUS&&(s=Number(configManager.getConfigurations().CONSENT_DIRECT_DEFAULT_FOCUS)),r=s,$('.tvium-container [tabindex="'+r+'"]').focus(),a=window.setTimeout(i,o)})})},this.removeKeyboardEvents=function(){keyset.setValue(0),document.removeEventListener("keydown",c),e(),$(".consent-section").empty()},this.registerKeyboardEvents=function(){keyset.setValue(keyset.NAVIGATION),logManager.log("Keyset bound: keyset.NAVIGATION - "+JSON.stringify(app.privateData.keyset)),document.addEventListener("keydown",c)},this.manageDownKeyEvent=function(){try{r<3&&(r++,a=window.setTimeout(i,o),r<=3&&$('.tvium-container [tabindex="'+r+'"]').focus())}catch(e){logManager.error("manageDownKeyEvent()"+e.message)}},this.manageUpKeyEvent=function(){try{-1==r?r++:$(":focus").hasClass("link--reset")?r=Number($(".skipfocus").attr("tabindex"))+1:0<r&&r<=3&&(r--,a=window.setTimeout(i,o)),$('.tvium-container [tabindex="'+r+'"]').focus()}catch(e){logManager.error("manageUpKeyEvent()"+e.message)}},this.manageRightKeyEvent=function(){try{3!=r&&-1!=r||r++,$('.tvium-container [tabindex="'+r+'"]').focus()}catch(e){logManager.error("manageRightKeyEvent()"+e.message)}},this.manageLeftKeyEvent=function(){try{-1==r?r++:4==r&&r--,$('.tvium-container [tabindex="'+r+'"]').focus()}catch(e){logManager.error("manageLeftKeyEvent()"+e.message)}},this.manageEnterKeyEvent=null,this.setEnterKeyEventHandler=function(e){t.manageEnterKeyEvent=e},this.setLabels=function(){$(".consent-section__banner__left__logo").html(labelsManager.getLabel("CONSENT_DIRECT_VALIDATION_OVERLAY_LEFT_LOGO")),$(".consent-section__banner__left__title").html(labelsManager.getLabel("CONSENT_DIRECT_VALIDATION_OVERLAY_LEFT_TITLE")),$(".consent-section__banner__left__message").html(labelsManager.getLabel("CONSENT_DIRECT_VALIDATION_OVERLAY_LEFT_TEXT")),$("#politique").html(labelsManager.getLabel("CONSENT_DIRECT_VALIDATION_OVERLAY_LEFT_TEXT_DOWN_POLITIQUE")),$("#partenaires").html(labelsManager.getLabel("CONSENT_DIRECT_VALIDATION_OVERLAY_LEFT_TEXT_DOWN_PARTENAIRES")),$(".consent-section__banner__right__title").html(labelsManager.getLabel("CONSENT_DIRECT_VALIDATION_OVERLAY_RIGHT_TITLE")),$("#buttonOk").val(labelsManager.getLabel("CONSENT_DIRECT_VALIDATION_OVERLAY_OK_BUTTON")),$("#buttonParameter").val(labelsManager.getLabel("CONSENT_DIRECT_VALIDATION_OVERLAY_PARAMETERS_BUTTON")),$("#buttonRefuser").val(labelsManager.getLabel("CONSENT_DIRECT_VALIDATION_OVERLAY_REFUSER_BUTTON"))},this.getCurrentPosition=function(){return r}},ConsentsErrorComponent=function(n,e){var t=this,a=null,o=Constants.CONSENT_BANNER_DISPLAY_TIME;function r(){$(".consent-section__banner").hide(0,function(){window.clearTimeout(a),t.removeKeyboardEvents(),activeContext=null,e(),$(".consent-section").empty()})}function s(e){switch(logManager.log("Keyset check - e.keyCode: "+e.keyCode+" e.code: "+e.code),e.keyCode){case KeyEvent.VK_UP:case e.VK_UP:case VK_UP:break;case KeyEvent.VK_DOWN:case e.VK_DOWN:case VK_DOWN:break;case KeyEvent.VK_RIGHT:case e.VK_RIGHT:case VK_RIGHT:break;case KeyEvent.VK_LEFT:case e.VK_LEFT:case VK_LEFT:break;case KeyEvent.VK_ENTER:case e.VK_ENTER:}e.preventDefault()}this.showConsentError=function(e){activeContext=t,null!=e&&(o=e),n&&n(),$(".consent-section").empty(),$(".consent-section").load("features/consent/templates/consent__consents-error.html",function(){t.registerKeyboardEvents(),t.setLabels(),$(".consent-section__banner").show(0),a=window.setTimeout(r,o)})},this.removeKeyboardEvents=function(){keyset.setValue(0),document.removeEventListener("keydown",s),e(),$(".consent-section").empty()},this.registerKeyboardEvents=function(){keyset.setValue(keyset.NAVIGATION),document.addEventListener("keydown",s)},this.setLabels=function(){$(".consent-section__banner__message").html(labelsManager.getLabel("CONSENT_ERROR_OVERLAY_TEXT"))}},ConsentsParametersOverlayComponent=function(e,n){var c=this,l=0,g=-1;function t(){return!(l!=g||!$('.tvium-container [tabindex="'+l+'"]').hasClass("skipfocus"))}function a(e){switch(logManager.log("Keyset check - e.keyCode: "+e.keyCode+" e.code: "+e.code),e.keyCode){case KeyEvent.VK_UP:case e.VK_UP:case VK_UP:t()?c.manageDownKeyEvent(yellowButtonEnabled):c.manageUpKeyEvent(yellowButtonEnabled);break;case KeyEvent.VK_DOWN:case e.VK_DOWN:case VK_DOWN:c.manageDownKeyEvent(yellowButtonEnabled);break;case KeyEvent.VK_RIGHT:case e.VK_RIGHT:case VK_RIGHT:t()?c.manageDownKeyEvent(yellowButtonEnabled):c.manageRightKeyEvent();break;case KeyEvent.VK_LEFT:case e.VK_LEFT:case VK_LEFT:t()?c.manageDownKeyEvent(yellowButtonEnabled):c.manageLeftKeyEvent();break;case KeyEvent.VK_ENTER:case e.VK_ENTER:case VK_ENTER:c.manageEnterKeyEvent(yellowButtonEnabled);break;case KeyEvent.VK_BACK:case e.VK_BACK:case VK_BACK:c.manageBackKeyEvent()}e.preventDefault()}this.init=function(e){c.consentModel=e},this.showConsentParametersOverlay=function(i){activeContext=c,e&&e(),$(".consent-section").load("features/consent/templates/consent__consents-parameters-overlay.html",function(){try{if(c.registerKeyboardEvents(),c.setLabels(),$("#confirmButtonAll").html(labelsManager.getLabel("CONSENT_PARAMETERS_OVERLAY_CONFIRM_ALL")),$("#refuserButtonAll").html(labelsManager.getLabel("CONSENT_PARAMETERS_OVERLAY_REFUSER_ALL")),$("#politique").html(labelsManager.getLabel("CONSENT_DIRECT_VALIDATION_OVERLAY_LEFT_TEXT_DOWN_POLITIQUE")),$("#partenaires").html(labelsManager.getLabel("CONSENT_DIRECT_VALIDATION_OVERLAY_LEFT_TEXT_DOWN_PARTENAIRES")),null!=c.consentModel.consents){var e="",n=3,t=" active";c.auxConsentModel=JSON.parse(JSON.stringify(c.consentModel));for(var a=0;a<c.consentModel.consents.length;a++){var o,r=c.consentModel.consents[a],s="";null!=i&&1==i?(s=r.modificationText,null!=r.consentStatus&&(o=r.consentStatus)):(s=r.consentText,o=r.consentStatus),e+='<div class="consent-section__page__contain__text">'+s+'</div><div class="consent-section__page__contain__buttons-container"><button class="consent-section__page__contain__buttons-container__button button '+(5<=n&&1!=i?" disabled":"")+(1==o?t:"")+'" id="t'+a+'" name="'+labelsManager.getLabel("CONSENT_PARAMETERS_OVERLAY_YES_BUTTON")+'" value="true" tabindex="'+n+'">'+labelsManager.getLabel("CONSENT_PARAMETERS_OVERLAY_YES_BUTTON")+"</button>",e+='<button class="consent-section__page__contain__buttons-container__button button '+(5<=++n&&1!=i?" disabled":"")+(0==o?t:"")+'" id="f'+a+'" name="'+labelsManager.getLabel("CONSENT_PARAMETERS_OVERLAY_NO_BUTTON")+'" value="false" tabindex="'+n+'">'+labelsManager.getLabel("CONSENT_PARAMETERS_OVERLAY_NO_BUTTON")+"</button></div>",n++}$(".consent-section__page__contain__buttons-container-all").after(e)}configManager.getConfigurations().CONSENT_PARAMETERS_DEFAULT_FOCUS&&(g=Number(configManager.getConfigurations().CONSENT_PARAMETERS_DEFAULT_FOCUS)),null!=i&&1==i?($("#confirmButton").focus(),$("#confirmButton").addClass("focused"),$("#headerText").html(labelsManager.getLabel("CONSENT_MODIFICATION_OVERLAY_HEADER_TEXT")),l=parseInt($("#confirmButton").attr("tabindex"))):(l=g,$('.tvium-container [tabindex="'+l+'"]').addClass("focused"),$("#headerText").html(labelsManager.getLabel("CONSENT_PARAMETERS_OVERLAY_HEADER_TEXT")),$(".consent-section__page__contain__message").html(labelsManager.getLabel("CONSENT_DIRECT_VALIDATION_OVERLAY_LEFT_TEXT")))}catch(e){logManager.error(e.message)}})},this.manageRightKeyEvent=function(){var e;try{e="Oui"==$(".focused").attr("name")||"rowbutton"==$(".focused").attr("name")&&11!=l?1:-1==l?2:0,$("*").removeClass("focused"),l+=e,$('.tvium-container [tabindex="'+l+'"]').hasClass("skipfocus")&&l++,$('.tvium-container [tabindex="'+l+'"]').addClass("focused")}catch(e){logManager.error(e.message)}},this.manageLeftKeyEvent=function(){try{"Non"==$(".focused").attr("name")||11==l?l-=1:"Oui"==$(".focused").attr("name")&&$(".focused").hasClass("all")?l+=9:0,$("*").removeClass("focused"),$('.tvium-container [tabindex="'+l+'"]').hasClass("skipfocus")&&l--,$('.tvium-container [tabindex="'+l+'"]').addClass("focused")}catch(e){logManager.error(e.message)}},this.manageUpKeyEvent=function(e){var n;try{-1!=l&&0!=l?(n="rowbutton"==$(".focused").attr("name")?$("*").hasClass("disabled")?11==l?10:9:11==l?2:1:"Non"==$(".focused").attr("name")?3:2,$("*").removeClass("focused"),l-=n):n=0,$('.tvium-container [tabindex="'+l+'"]').hasClass("skipfocus")&&l--,$('.tvium-container [tabindex="'+l+'"]').addClass("focused")}catch(e){logManager.error(e.message)}},this.manageDownKeyEvent=function(e){var n;try{0!=(n=l==g&&$('.tvium-container [tabindex="'+l+'"]').hasClass("skipfocus")?1:"Oui"==$(".focused").attr("name")&&$('.tvium-container [tabindex="'+(l+2)+'"]').hasClass("button")&&!$('.tvium-container [tabindex="'+(l+2)+'"]').hasClass("disabled")||-1==l?2:"Non"==$(".focused").attr("name")&&$('.tvium-container [tabindex="'+(l+2)+'"]').hasClass("button")&&!$('.tvium-container [tabindex="'+(l+2)+'"]').hasClass("disabled")||"Valider"==$(".focused").attr("name")?1:"Oui"==$(".focused").attr("name")&&3==$("button.active").length?2:"Non"==$(".focused").attr("name")&&3==$("button.active").length?1:0)&&($("*").removeClass("focused"),l+=n,$('.tvium-container [tabindex="'+l+'"]').hasClass("skipfocus")&&l++,$('.tvium-container [tabindex="'+l+'"]').addClass("focused"))}catch(e){logManager.error(e.message)}},this.manageEnterKeyEvent=null,this.manageBackKeyEvent=null,this.manageShowPrivacyPolicy=null,this.manageShowPartner=null,this.manageShowErrorMessage=null,this.getAuxContentModel=function(){return c.auxConsentModel},this.setEnterKeyEventHandler=function(e){c.manageEnterKeyEvent=e},this.setBackKeyEventHandler=function(e){c.manageBackKeyEvent=e},this.fadeOutError=function(){$(".consent-section__banner").fadeOut(1e3,function(){c.removeKeyboardEvents(),n()})},this.removeKeyboardEvents=function(){keyset.setValue(0),document.removeEventListener("keydown",a),n(),$(".consent-section").empty(),activeContext=null},this.registerKeyboardEvents=function(){keyset.setValue(keyset.NAVIGATION),logManager.log("Keyset bound: keyset.NAVIGATION - "+JSON.stringify(app.privateData.keyset)),document.addEventListener("keydown",a)},this.setLabels=function(){$("#backButton").html(labelsManager.getLabel("CONSENT_PARAMETERS_OVERLAY_BACK_BUTTON")),$("#headerTitle").html(labelsManager.getLabel("CONSENT_PARAMETERS_OVERLAY_TITLE")),$("#headerButton").text(labelsManager.getLabel("CONSENT_PARAMETERS_OVERLAY_LEFT_HEADER_BUTTON")),$("#confirmButton").text(labelsManager.getLabel("CONSENT_PARAMETERS_OVERLAY_LEFT_CONFIRM_BUTTON")),$(".consent-section__page__left__message_down_link_1").html(labelsManager.getLabel("CONSENT_DIRECT_VALIDATION_OVERLAY_LEFT_TEXT_DOWN_LINK_1")),$(".consent-section__page__left__message_down_link_2").html(labelsManager.getLabel("CONSENT_DIRECT_VALIDATION_OVERLAY_LEFT_TEXT_DOWN_LINK_2")),$(".consent-section__page__title_dx").html(labelsManager.getLabel("CONSENT_DIRECT_VALIDATION_OVERLAY_RIGHT_TITLE"))},this.updateModel=function(e){try{c.consentModel=e}catch(e){logManager.error(e.message)}}},ConsentsPartnerComponent=function(e,n){var t=this,a=2,o=0,r="";function s(e){switch(logManager.log("Keyset check - e.keyCode: "+e.keyCode+" e.code: "+e.code),e.keyCode){case KeyEvent.VK_ENTER:case e.VK_ENTER:case VK_ENTER:t.manageEnterKeyEvent();break;case KeyEvent.VK_BACK:case e.VK_BACK:case VK_BACK:t.manageBackKeyEvent();break;case KeyEvent.VK_UP:case e.VK_UP:case VK_UP:t.manageUpKeyEvent();break;case KeyEvent.VK_DOWN:case e.VK_DOWN:case VK_DOWN:t.manageDownKeyEvent();break;case KeyEvent.VK_LEFT:case e.VK_LEFT:case VK_LEFT:t.manageLeftKeyEvent();break;case KeyEvent.VK_RIGHT:case e.VK_RIGHT:case VK_RIGHT:t.manageRightKeyEvent()}e.preventDefault()}this.showConsentPartner=function(n){e&&e(),$(".consent-section").empty(),$(".consent-section").load("features/consent/templates/consent__consents-partenaires.html",function(){t.registerKeyboardEvents(),t.setLabels(),configManager.getConfigurations().CONSENT_PARTENAIRES_DEFAULT_FOCUS&&(a=Number(configManager.getConfigurations().CONSENT_PARTENAIRES_DEFAULT_FOCUS)),$('.tvium-container [tabindex="'+a+'"]').focus(),$('.tvium-container [tabindex="'+a+'"]').addClass("focused"),n&&""!=n&&(r=n),$("#backButton").attr("pagefrom",r);var e=configManager.getConfigurations().API_ENDPOINT+"partners";1==configManager.getConfigurations().DUMMY_API&&(e+="/getPartnerBannerDummy.json"),$.ajax({type:"GET",url:e,contentType:"application/json",dataType:"json"}).done(function(e,n,t){!function(e){var n="";if(e&&e.PARTNERS){var t=e.PARTNERS,a=Object.keys(t);if(0<a.length){for(var o=0;o<a.length;o++){var r=t[a[o]];n+=function(e,n){for(var t='<div class="consent-section__page__contain__partenaires__partners__partner_item" id="partner_'+n+'"><div class="consent-section__page__contain__partenaires__partners__partner_item__name">'+e.NAME+"</div><span>"+labelsManager.getLabel("CONSENT_PARTENAIRES_FINALITE")+"</span><ul>",a=0;a<e.CONSENTS.length;a++)t+="<li>"+e.CONSENTS[a].CONSENTNAME+"</li>";return t+='</ul><div class="consent-section__page__contain__partenaires__partners__partner_item__link">'+labelsManager.getLabel("CONSENT_PARTENAIRES_SITE")+'<a href="'+e.URL_POLITIQUE+'">'+e.URL_POLITIQUE+"</a></div></div>"}(r,o)}$(".consent-section__page__contain__partenaires--txt").html(labelsManager.getLabel("CONSENT_PARTENAIRES_HEADER_TEXT")),$("#politique").html(labelsManager.getLabel("CONSENT_PARTENAIRES_POLITIQUE")),$(".consent-section__page__contain__partenaires__partners").html(n)}}""==n&&$(".consent-section__page__contain__partenaires--txt").html(labelsManager.getLabel("CONSENT_PARTENAIRES_HEADER_EMPTY_TEXT"))}(e)}).fail(function(e,n,t){logManager.log(t)})})},this.manageEnterKeyEvent=null,this.manageBackKeyEvent=null,this.setEnterKeyEventHandler=function(e){t.manageEnterKeyEvent=e},this.setBackKeyEventHandler=function(e){t.manageBackKeyEvent=e},this.manageLeftKeyEvent=function(){var e;$(".tvium-container .focused")[0]&&"partenairesText"===(e=$(".tvium-container .focused")[0].id)&&($("#backButton").addClass("focused"),$("#"+e).removeClass("focused"))},this.manageRightKeyEvent=function(){var e;$(".tvium-container .focused")[0]&&"backButton"===(e=$(".tvium-container .focused")[0].id)&&($("#partenairesText").addClass("focused"),$("#"+e).removeClass("focused"))},this.manageUpKeyEvent=function(){var e;if($(".tvium-container .focused")[0])switch(e=$(".tvium-container .focused")[0].id){case"partenairesText":$("#partenairesText")[0].scrollTop<=0?($("#backButton").addClass("focused"),$("#"+e).removeClass("focused")):$("#partenairesText")[0].scrollTop=$("#partenairesText")[0].scrollTop-50;break;case"politique":$("#"+e).removeClass("focused"),$("#"+e).removeClass("active"),$("#backButton").addClass("focused")}},this.manageDownKeyEvent=function(){var e,n=$("#partenairesText").height(),t=$(".consent-section__page__contain__partenaires__partners").height()-n;if($(".tvium-container .focused")[0])switch(e=$(".tvium-container .focused")[0].id){case"backButton":$("#partenairesText").addClass("focused"),$("#"+e).removeClass("focused");break;case"partenairesText":50*o<t?($("#partenairesText")[0].scrollTop=$("#partenairesText")[0].scrollTop+50,o+=1):($("#"+e).removeClass("focused"),$("#politique").addClass("focused"),$("#politique").addClass("active"))}},this.removeKeyboardEvents=function(){keyset.setValue(0),document.removeEventListener("keydown",s),n(),$(".consent-section").empty()},this.registerKeyboardEvents=function(){keyset.setValue(keyset.NAVIGATION),document.addEventListener("keydown",s)},this.setLabels=function(){$(".consent-section__page__back-button").html(labelsManager.getLabel("CONSENT_PARTENAIRES_BACK_BUTTON")),$(".consent-section__page__title").html(labelsManager.getLabel("CONSENT_PARTENAIRES_HEADER_TITLE"))}},ConsentsPrivacyPolicyComponent=function(n,e){var t=this,a=0,o=0;function r(e){switch(logManager.log("Keyset check - e.keyCode: "+e.keyCode+" e.code: "+e.code),e.keyCode){case KeyEvent.VK_ENTER:case e.VK_ENTER:case VK_ENTER:t.manageEnterKeyEvent();break;case KeyEvent.VK_BACK:case e.VK_BACK:case VK_BACK:t.manageBackKeyEvent();break;case KeyEvent.VK_UP:case e.VK_UP:case VK_UP:t.manageUpKeyEvent();break;case KeyEvent.VK_DOWN:case e.VK_DOWN:case VK_DOWN:t.manageDownKeyEvent();break;case KeyEvent.VK_LEFT:case e.VK_LEFT:case VK_LEFT:t.manageLeftKeyEvent();break;case KeyEvent.VK_RIGHT:case e.VK_RIGHT:case VK_RIGHT:t.manageRightKeyEvent()}e.preventDefault()}this.showConsentPrivacyPolicy=function(e){n&&n(),$(".consent-section").empty(),$(".consent-section").load("features/consent/templates/consent__consents-privacy-policy.html",function(){t.registerKeyboardEvents(),t.setLabels(),configManager.getConfigurations().CONSENT_PRIVACY_DEFAULT_FOCUS&&(o=Number(configManager.getConfigurations().CONSENT_PRIVACY_DEFAULT_FOCUS)),a=o,$('.tvium-container [tabindex="'+a+'"]').focus(),$('.tvium-container [tabindex="'+a+'"]').addClass("focused"),$("#backButton").attr("pagefrom",e)})},this.manageEnterKeyEvent=null,this.manageBackKeyEvent=null,this.setEnterKeyEventHandler=function(e){t.manageEnterKeyEvent=e},this.setBackKeyEventHandler=function(e){t.manageBackKeyEvent=e},this.manageLeftKeyEvent=function(){try{0==a&&($("*").removeClass("focused"),a--,$('.tvium-container [tabindex="'+a+'"]').addClass("focused"))}catch(e){logManager.error(e.message)}},this.manageRightKeyEvent=function(){try{-1==a&&($("*").removeClass("focused"),a++,$('.tvium-container [tabindex="'+a+'"]').addClass("focused"))}catch(e){logManager.error(e.message)}},this.manageUpKeyEvent=function(){try{0==a&&($("#privacyPolicyText")[0].scrollTop=$("#privacyPolicyText")[0].scrollTop-50)}catch(e){logManager.error(e.message)}},this.manageDownKeyEvent=function(){try{0==a&&($("#privacyPolicyText")[0].scrollTop=$("#privacyPolicyText")[0].scrollTop+50)}catch(e){logManager.error(e.message)}},this.removeKeyboardEvents=function(){keyset.setValue(0),document.removeEventListener("keydown",r),e(),$(".consent-section").empty()},this.registerKeyboardEvents=function(){keyset.setValue(keyset.NAVIGATION),document.addEventListener("keydown",r)},this.setLabels=function(){$(".consent-section__page__back-button").html(labelsManager.getLabel("CONSENT_PRIVACY_POLICY_BACK_BUTTON")),$(".consent-section__page__title").html(labelsManager.getLabel("CONSENT_PRIVACY_POLICY_HEADER_TITLE")),$(".consent-section__page__contain__politique--upper").html(labelsManager.getLabel("CONSENT_PRIVACY_POLICY_HEADER_TEXT")),$(".consent-section__page__contain__politique--body").html(labelsManager.getLabel("CONSENT_PRIVACY_POLICY_TEXT"))}},ConsentRequests=function(){var i=this,s=0,c=configManager.getConfigurations().MAXIMUM_NUMBER_CONSENTS_RETRIES||1;this.getConsentGET=function(a,n){var o="ConsentRequests.getConsent()";logManager.log(o);var e=configManager.getConfigurations().API_ENDPOINT+"consents";1==configManager.getConfigurations().DUMMY_API&&(e+="/getConsentsDummy.json");var t="",r="";null!=consentManager.getModel()&&null!=consentManager.getModel().tvId&&(t="tvId="+consentManager.getModel().tvId,r="?"),logManager.log(o+" "+e+r+t),$.ajax({type:"GET",url:e,data:t,timeout:configManager.getConfigurations().GET_CONSENT_CALL_TIMEOUT,success:function(e,n,t){logManager.log(o+" - Response : "+JSON.stringify(e,null,4)),a(e)},error:function(e){s<c?(s++,i.getConsentGET(a,n)):(logManager.error(o+" - Error : "+JSON.stringify(e,null,4)),n())}})},this.getConsentPOST=function(n,t,a,o){var r="ConsentRequests.getConsentPOST()";logManager.log(r),o=o||0;var e=JSON.stringify(a);logManager.log(r+" payload: "+e);var s=configManager.getConfigurations().API_ENDPOINT+"consents";1==configManager.getConfigurations().DUMMY_API&&(s+="/getConsentsDummy.json"),$.ajax({type:"POST",url:s,data:e,contentType:"application/json",dataType:"json",timeout:configManager.getConfigurations().SET_CONSENT_CALL_TIMEOUT,success:function(e){logManager.log("Response "+r+": "+JSON.stringify(e,null,4)),("OK"==e.result?n:t)(e)},error:function(e){o<c?(o++,i.getConsentPOST(n,t,a,o)):(logManager.error("Error "+r+": "+JSON.stringify(e,null,4)),t())}})}},TraceManager=function(){var e=new TraceRequests;this.startHeartbeat=function(){-1!=configManager.getConfigurations().HEARTBEAT_TIME_INTERVAL&&setInterval(function(){try{e.heartbeat()}catch(e){logManager.error(e.message)}},configManager.getConfigurations().HEARTBEAT_TIME_INTERVAL)},this.injectTrackingPixel=function(e){$("#trackingPixel").remove();var n=document.createElement("img");n.setAttribute("id","trackingPixel"),n.src=escapeXml(e),n.setAttribute("alt",escapeXml(e)),document.getElementsByClassName("tvium-container")[0].appendChild(n)}},TraceRequests=function(){this.heartbeat=function(){var n="TraceRequests.heartbeat()",e="",t="";serviceManager.getCurrentChannel()?(e=serviceManager.getCurrentChannel().getChannelToString(),null!=consentManager.getModel()&&null!=consentManager.getModel().tvId&&(t=consentManager.getModel().tvId),t=JSON.stringify({tvId:t,triplet:e,timestamp:(new Date).getTime().toString()}),logManager.log(n+" - payload heartbeat: "+t),e=configManager.getConfigurations().HEARTBEAT_URL,$.ajax({type:"POST",url:e,data:t,timeout:configManager.getConfigurations().HEARTBEAT_TIME_INTERVAL,success:function(e){logManager.log(n+" - Response: "+JSON.stringify(e))},error:function(e){logManager.error(n+" - Error:"+JSON.stringify(e))}})):logManager.error(n+" - currentChannel is not set")}},AdvHashmap=function(){var a={status:null,dictionary:null},t=null,o={LOADING:"LOADING",LOADED:"LOADED",STARTING:"STARTING",STARTED:"STARTED",STOP:"STOP"};function r(e){return e in a}return{deleteAdv:function(e){delete a[e],logManager.log("deleteAdv -  Adv Deleted!")},initialize:function(e){a[e.toString()]={status:null,dictionary:null}},setValue:function(e,n,t){r(e)||(a[e]={}),a[e].dictionary=n,a[e].type=t},getValue:function(e){return r(e)?a[e]:null},setStatus:function(e,n){r(e)?(a[e].status=n)==o.STARTING?t=e:n==o.STOP&&(t=null,logManager.log("Status: "+n)):logManager.warning("Adv ID not found: "+e)},isAdvIDExists:r,isAdvAlreadyStarted:function(){return null!=t},lstStatus:o,type:{STREAMEVENT:"STREAMEVENT"},clearLst:function(){a={},t=null},lstAdvIsEmpty:function(){return 0==Object.keys(a).length||0==Object.keys(a).length}}},AdvManager=function(){var a,m=this,v=new AdvHashmap,_=new AdvRequests,f={},n={AdEvent:"ADEVENT"};function t(){logManager.log("Stream Events Listening Method init..."),objVideo=serviceManager.getObjVideo();try{featuresManager.getFeature("streamEventDVBMethod")?(logManager.log("Adv Listening Method: streamEventDVBMethod"),e(m.streamEventsHandlerComponent.registerStreamEventsListeners)):featuresManager.getFeature("streamEventXMLMethod")?(logManager.log("Adv Listening Method: streamEventXMLMethod"),e(m.streamEventsHandlerComponent.registerStreamEventsListeners)):logManager.log("Adv Listening Method: none (as per features file definition)")}catch(e){logManager.error("initStreamEventsMethod: "+e)}}function e(e){objVideo?2===objVideo.playState?(logManager.log("presenting channel ready"),e()):(logManager.log("presenting channel not ready, listen playstateChange"),objVideo.onPlayStateChange=o):logManager.warning("The application is broadcast dependent, try to attach to broadcast")}function o(e,n){switch(e){case 0:logManager.log("state video broadcast: unrealized");break;case 1:logManager.log("state video broadcast: connecting");break;case 2:logManager.log("state video broadcast: presenting"),t(),objVideo.onPlayStateChange=function(){};break;case 3:logManager.log("state video broadcast: stopped")}}function r(e){try{e&&e.name===n.AdEvent?(logManager.log("onAdEventReceived: "+function(e){var n="";try{var t=JSON.stringify(e,null,4);n="{}"===t?"Status:"+e.status+" - Text: "+e.text:t}catch(e){}return n}(e)),"error"===e.status?(logManager.warning("Event onAdEventReceived on error status, re-registering Stream Events listeners."),m.streamEventsHandlerComponent.unregisterStreamEventsListeners(),t()):"trigger"===e.status&&(e.text?JSON.parse(e.text).hasOwnProperty("event_type")?logManager.error("onAdEventReceived - Stream Event ignored."):"spot"===configManager.getConfigurations().AD_SUBSTITUTION_METHOD?T(e.text):"break"===configManager.getConfigurations().AD_SUBSTITUTION_METHOD?s(e.text,null):logManager.warning("onAdEventReceived - No SpotMode or BreakMode set in the configuration."):logManager.error("onAdEventReceived - empty payload!"))):e?logManager.warning("onAdEventReceived - wrong event Name: "+e.name):logManager.warning("onAdEventReceived - payload not defined")}catch(e){logManager.error("onAdEventReceived - error: "+e.message)}}function T(e){try{var n=JSON.parse(e);if(n.STARTdata.triplet!==serviceManager.getCurrentChannel().getChannelToString())return void logManager.warning("startEventProcess - event triplet ("+n.STARTdata.triplet+") not corresponding to current channel's triplet ("+serviceManager.getCurrentChannel().getChannelToString()+")");v.getValue(n.STARTdata.break_code)?i(e):configManager.getConfigurations().CALL_ADSERVER_FALLBACK_ON_STARTEVENT&&"spot"===configManager.getConfigurations().AD_SUBSTITUTION_METHOD?(logManager.log("startEventProcess - break_code not found in dictionary: triggering callAdServer."),s(e,function(){i(e)})):logManager.warning("startEventProcess - break code not found in dictionary.")}catch(e){logManager.error("startEventProcess - error: "+e.message)}}function s(e,o){try{if(null==featuresManager.getFeature("linearAdTracking")||!0!==featuresManager.getFeature("linearAdTracking"))return void logManager.warning("callAdServerProcess - linearAdTracking feature is not true");if(null==consentManager.getModel()||!0!==consentManager.getModelConsents().TRACKING.consentStatus)return void logManager.warning("callAdServerProcess - user consent not given to TRACKING");var r=JSON.parse(e);if(0!==Object.keys(f).length&&"break"===configManager.getConfigurations().AD_SUBSTITUTION_METHOD)return void logManager.warning("callAdServerProcess - Discarding Event: Break tracking already in progress.");if(r.LOADdata.triplet!==serviceManager.getCurrentChannel().getChannelToString())return void logManager.warning("callAdServerProcess - event triplet ("+r.LOADdata.triplet+") not corresponding to current channel's triplet ("+serviceManager.getCurrentChannel().getChannelToString()+")");if(v.isAdvIDExists(r.LOADdata.break_code))return void logManager.warning("callAdServerProcess - break code already loaded");if(v.initialize(r.LOADdata.break_code),v.setStatus(r.LOADdata.break_code,v.lstStatus.LOADING),null==consentManager.getModel())return void logManager.warning("callAdServerProcess - getWizadsData() the tvId is not retrived yet");r.LOADdata.channel&&(r.LOADdata.channel=r.LOADdata.channel.toUpperCase());var n=consentManager.getModel().tvId,t=n+(new Date).getTime(),a=r.LOADdata.dai_version,s=r.LOADdata.channel,i=r.LOADdata.break_code,c=r.LOADdata.bday||"",l=r.LOADdata.break_duration,g=configManager.getPlatform().brand.toLowerCase().trim(),u=configManager.getConfigurations().AD_SUBSTITUTION_METHOD,d=configManager.getConfigurations().ADSERVER_URL;d+="?dai_version="+a+"&transaction_id="+t+"&response_type="+u+"&channel="+s+"&break_code="+i+"&break_day="+c+"&break_duration="+l+"&advertising_id="+n+"&platform="+g+"&context=live&current_spot=0";var E=Date.now();_.getWizadsData(d,function(e){var n,t;function a(){logManager.log("breakTracking - Processing break["+n.LOADdata.break_code+"] - Sequence["+t+"] started");var e={LOADdata:n.LOADdata,STARTdata:{break_code:n.STARTdata.break_code,sequence:t,triplet:n.STARTdata.triplet,duration:f.spots[t].duration,pts:0}};null!=f.spots[t+1]&&window.setTimeout(a,f.spots[t].duration+configManager.getConfigurations().BLACK_FRAMES_DURATION_AFTER_SPOT),T(JSON.stringify(e)),t++}m.callAdServerRoundTripTime=Date.now()-E,0!==Object.keys(e).length?(function(e,n){try{f={},logManager.log("createDictionary() - Creating dictionary");var t=n.Ads;if(0<t.length){f.id=e,logManager.log("createDictionary() - dictionary.id: "+f.id),f.spots=[];for(var a=0;a<t.length;a++)f.spots[parseInt(t[a].Sequence)]=function(e){var n;return(n=function(e){try{var n={},t=e.InLine.Creatives[0].Linear.Duration;n.duration=1e3*+t,n.tracking={};var a=e.InLine.Creatives[0].Linear.TrackingEvents;n.tracking.impression=e.InLine.Impressions[0].Data.trim();for(var o=0;o<a.length;o++)switch(a[o].Event){case"firstQuartile":n.tracking.firstQuartile=a[o].Data.trim();break;case"midpoint":n.tracking.midpoint=a[o].Data.trim();break;case"thirdQuartile":n.tracking.thirdQuartile=a[o].Data.trim();break;case"complete":n.tracking.complete=a[o].Data.trim()}var r=e.InLine.Creatives[0].Linear.MediaFiles[0].Data.trim();return n.media_file_url=r,n.media_file_type="addressed",-1!==r.indexOf("broadcasted")&&(n.media_file_type="broadcasted"),n}catch(e){logManager.error("createTrackingItemsForDictionary: "+e)}}(e)).companionAd=function(e){try{var n={};return n=null!=e.InLine.Creatives[0].CompanionAds?e.InLine.Creatives[0].CompanionAds:n}catch(e){logManager.error("createCompanionAdForDictionary: "+e)}}(e),n}(t[a]),logManager.log("createDictionary() - dictionary.spots["+parseInt(t[a].Sequence)+"] tracking items loaded")}else logManager.log("createDictionary() - no Ads found in VAST file.")}catch(e){logManager.error("createDictionary: "+e)}}(r.LOADdata.break_code,e),v.setValue(r.LOADdata.break_code,f,v.type.STREAMEVENT),v.setStatus(r.LOADdata.break_code,v.lstStatus.LOADED),null!=o&&o(),"break"===configManager.getConfigurations().AD_SUBSTITUTION_METHOD&&(t=(n=r).STARTdata.sequence,featuresManager.getFeature("PTSMethod")?(logManager.warning("breakTracking - Waiting first START PTS time in order to start tracking queue."),m.ptsHandlerComponent.ptsStartEventTimeCheck(n,a)):(logManager.warning("breakTracking - no PTS or Delay method for this client in the feature file. Queuing starts immediately."),a()))):logManager.log("callAdServerProcess - VAST file is an empty object.")},function(e){C(r.LOADdata.break_code),logManager.error("getWizadsData() KO Response")})}catch(e){logManager.error("callAdServerProcess - error: "+e.message)}}function i(e){var n=JSON.parse(e),t=v.getValue(n.STARTdata.break_code);if(t.status===v.lstStatus.LOADED||t.status===v.lstStatus.STARTED)if(v.setStatus(n.STARTdata.break_code,v.lstStatus.STARTED),f.spots.hasOwnProperty(n.STARTdata.sequence))if(logManager.log("startEventProcessPostValidation - Event payload: "+e),n.STARTdata.duration===f.spots[n.STARTdata.sequence].duration)switch(configManager.getConfigurations().AD_SUBSTITUTION_METHOD){case"spot":featuresManager.getFeature("PTSMethod")?m.ptsHandlerComponent.ptsStartEventTimeCheck(n,c):logManager.warning("startEventProcess - no PTS or Delay method for this client in the feature file.");break;case"break":c(n);break;default:logManager.warning('startEventProcess - no "break" or "spot" mode enabled.')}else logManager.warning("startEventProcess - spot duration in Stream Event payload ("+n.STARTdata.duration+") not matching the VAST duration for this spot ("+f.spots[n.STARTdata.sequence].duration+")");else logManager.warning("startEventProcess - sequence not found: "+n.STARTdata.sequence);else logManager.warning("startEventProcess - incorrect status : "+t.status)}function c(e){v.getValue(e.STARTdata.break_code)?null==consentManager.getModel()||!0!==consentManager.getModelConsents().TRACKING.consentStatus?(logManager.warning("startEventCoreProcess - user consent not given to TRACKING"),g(e.STARTdata.break_code,e.STARTdata.sequence)):featuresManager.getFeature("linearAdTracking")&&!0===featuresManager.getFeature("linearAdTracking")&&function(n){try{var e,t;null!=f&&0<Object.keys(f).length&&null!=n.STARTdata.sequence&&f.id===n.STARTdata.break_code?(e=f.spots[n.STARTdata.sequence].duration/4,t=0,l(f.spots[n.STARTdata.sequence].tracking.impression,"impression",n.STARTdata.sequence),a=window.setInterval(function(){switch(++t){case 1:l(f.spots[n.STARTdata.sequence].tracking.firstQuartile,"firstQuartile",n.STARTdata.sequence);break;case 2:l(f.spots[n.STARTdata.sequence].tracking.midpoint,"midpoint",n.STARTdata.sequence);break;case 3:l(f.spots[n.STARTdata.sequence].tracking.thirdQuartile,"thirdQuartile",n.STARTdata.sequence);break;case 4:!function(e){l(f.spots[e.STARTdata.sequence].tracking.complete,"complete",e.STARTdata.sequence),a&&window.clearInterval(a);g(e.STARTdata.break_code,e.STARTdata.sequence),logManager.log("Adv pixel tracking schedulation ended.")}(n)}},e)):logManager.warning("scheduleSpotTracking - empty dictionary")}catch(e){logManager.error("scheduleSpotTracking: "+e),g(n.STARTdata.break_code,n.STARTdata.sequence)}}(e):logManager.warning("startEventCoreProcess - break code not found")}function l(e,n,t){if(traceManager.injectTrackingPixel(e),configManager.getConfigurations().VISIBLE_AD_TRACKING)switch(n){case"impression":case"complete":!function(e,n,t){var a=$(".trackingPopupContainer"),o="5%";1<=a.length&&(o="50%");var r=$("<div class='trackingPopupContainer' style='position:absolute; top:"+o+"; left:65px; width: 50%; padding:5px; z-index: 9999; background-color:rgba(255,255,255,0.7); color:#000; border:1px solid #000; word-break: break-all;'><b>Sequence: </b>"+t+"<br /><b>Tracking: </b>"+$.camelCase(e)+"<br /><b>URL: </b> "+escapeXml(n)+"</div>");$(".tvium-container").append(r),window.setTimeout(function(){r.remove()},3e3)}(n,e,t)}logManager.log("Sequence["+t+"] - "+n+" pixel image loaded - "+escapeXml(e))}function g(e,n){f.spots.hasOwnProperty(n)?(delete f.spots[n],0===Object.keys(f.spots).length&&(C(e),v.clearLst(),f={},logManager.log("All spots of the break has been removed!"))):logManager.warning("removeSpotFromDictionary - "+n+" not found")}function C(e){v.isAdvIDExists(e)?(v.setStatus(e,v.lstStatus.STOP),v.deleteAdv(e)):logManager.warning("clearAdv - event ID not found")}return this.streamEventsHandlerComponent=new StreamEventsHandlerComponent(r),this.ptsHandlerComponent=new PtsHandlerComponent,this.callAdServerRoundTripTime=0,{initStreamEventsMethod:t,onAdEventReceived:r,callAdServerProcess:s,startProcess:T,registerStreamEventsListeners:this.streamEventsHandlerComponent.registerStreamEventsListeners,unregisterStreamEventsListeners:this.streamEventsHandlerComponent.unregisterStreamEventsListeners}},PtsHandlerComponent=function(){this.ptsStartEventTimeCheck=function(t,a){null!=mediaSyncManager.getCurrentTime()?(logManager.log("ptsStartEventTimeCheck - currentTime: "+mediaSyncManager.getCurrentTime()+" - PTS check starting in "+(t.STARTdata.pts-mediaSyncManager.getCurrentTime()-configManager.getConfigurations().PTS_CHECK_START_TIME-featuresManager.getFeature("ptsSpotModeSwitchInDurationFineTuning"))+"Ms."),setTimeout(function(){var n=setInterval(function(){var e=mediaSyncManager.getCurrentTime();logManager.log("MediaSynchroniser.currentTime = "+e+" - Event PTS time = "+t.STARTdata.pts+" - Time difference = "+(Math.abs(t.STARTdata.pts-e)-featuresManager.getFeature("ptsSpotModeSwitchInDurationFineTuning"))),t.STARTdata.pts-e-featuresManager.getFeature("ptsSpotModeSwitchInDurationFineTuning")+configManager.getConfigurations().PTS_CHECK_TOLERANCE<0&&(logManager.warning("ptsStartEventTimeCheck - payload PTS already expired. We can't go back in time Morty!"),window.clearInterval(n)),Math.abs(t.STARTdata.pts-e-featuresManager.getFeature("ptsSpotModeSwitchInDurationFineTuning"))<=configManager.getConfigurations().PTS_CHECK_TOLERANCE&&(a(t),window.clearInterval(n))},configManager.getConfigurations().PTS_CHECK_INTERVAL_TIME+featuresManager.getFeature("PTSCheckIntervalFineTuning"))},t.STARTdata.pts-mediaSyncManager.getCurrentTime()-configManager.getConfigurations().PTS_CHECK_START_TIME-featuresManager.getFeature("ptsSpotModeSwitchInDurationFineTuning"))):logManager.error("ptsStartEventTimeCheck - MediaSynchroniser not available")}},StreamEventsHandlerComponent=function(e){var n=null;this.registerStreamEventsListeners=function(){try{null!=(n=function(){var e=null;{if(featuresManager.getFeature("streamEventDVBMethod")){var n=null,t=null;try{var a=objVideo.currentChannel;a?(n=a.onid.toString(16)+"."+a.tsid.toString(16)+"."+a.sid.toString(16),logManager.log("current channel ID(hex) = "+n+", type=null, name="+a.name)):logManager.warning("currentChannel not defined")}catch(e){throw logManager.error("getUrlStreamEventObj: "+e),e}return serviceManager.getCurrentChannel()&&(e=serviceManager.getCurrentChannel().getChannelToString(),null==configManager.getConfigurations().STREAM_EVENT_CONFIGURATION[e]?logManager.warning("getUrlStreamEventObj - No DVB STREAM EVENT CONFIGURATION for this channel ("+e+")"):t="dvb://"+n+"."+configManager.getConfigurations().STREAM_EVENT_CONFIGURATION[e].DVB_OBJECT_CAROUSEL_COMPONENT_TAG.toString(16)+"/"+configManager.getConfigurations().STREAM_EVENT_CONFIGURATION[e].DVB_STREAM_EVENTS_OBJECT_NAME),t}if(featuresManager.getFeature("streamEventXMLMethod"))return serviceManager.getCurrentChannel()&&(e=serviceManager.getCurrentChannel().getChannelToString()),logManager.log(configManager.getConfigurations().STREAM_EVENT_CONFIGURATION[e].XML_STREAM_EVENTS_XML_DEFINITION),configManager.getConfigurations().STREAM_EVENT_CONFIGURATION[e].XML_STREAM_EVENTS_XML_DEFINITION}}())?(logManager.log("streamEventObjectURL: "+n),objVideo.addStreamEventListener(n,"ADEVENT",e),logManager.log("ADEVENT Registered")):logManager.warning("registerEvents: Stream Events Listeners not registered, no Carousel definition for this channel")}catch(e){logManager.error("registerEvents: "+e)}},this.unregisterStreamEventsListeners=function(){logManager.log("Stream event Unregistering...");try{e&&objVideo.removeStreamEventListener(n,"ADEVENT",e),logManager.log("ADEVENT Unregistered")}catch(e){logManager.error("Error on Stream event Unregistered: "+e.message)}logManager.log("Stream event Unregistered")}},AdvRequests=function(){var i=0;this.getWizadsData=function(a,o,r){var s="AdvRequests.getWizadsData()",e=a;logManager.log(s+" CALLED - url: "+a),$.ajax({type:"GET",contentType:"application/json",dataType:"json",url:e,timeout:configManager.getConfigurations().GET_WIZADS_TIMEOUT,success:function(e,n,t){logManager.log(s+" - Response : OK"),o(e)},error:function(e,n,t){logManager.error(s+" - Error : "+JSON.stringify(t,null,4)),"timeout"===n&&i<1&&(i++,self.getWizadsData(a,o,r)),r()}})}};